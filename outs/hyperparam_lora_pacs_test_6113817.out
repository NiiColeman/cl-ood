Using device: cuda

Dataset: PACS
Number of classes: 7
Number of domains: 4
Total number of samples: 9991
Number of training samples: 7992
Number of validation samples: 1999

Trying: lr=1e-4, batch_size=32, num_epochs=5
Epoch 1/5, Train Loss: 0.4762, Train Acc: 83.92%, Val Loss: 0.2590, Val Acc: 91.20%
Epoch 2/5, Train Loss: 0.1533, Train Acc: 95.17%, Val Loss: 0.3076, Val Acc: 90.75%
Epoch 3/5, Train Loss: 0.1120, Train Acc: 96.23%, Val Loss: 0.2927, Val Acc: 91.75%
Epoch 4/5, Train Loss: 0.0935, Train Acc: 96.82%, Val Loss: 0.2485, Val Acc: 92.50%
Epoch 5/5, Train Loss: 0.0711, Train Acc: 97.48%, Val Loss: 0.4013, Val Acc: 90.10%

Best hyperparameters for PACS without LoRA:
Best params: {'lr': '1e-4', 'batch_size': 32, 'num_epochs': 5}
Best validation accuracy: 90.10%
Best model without LoRA saved to /leonardo_scratch/fast/IscrC_FoundCL/cl/lora-CL/ratatouille/ood/exp_outs/best_model_PACS_without_lora.pth

LoRA Hyperparameter Search for Dataset: PACS
Number of classes: 7
Number of domains: 4
Total number of samples: 9991
Number of training samples: 7992
Number of validation samples: 1999

Trying LoRA params: r=8, alpha=8, dropout=0.1
Epoch 1/5, Train Loss: 1.3411, Train Acc: 50.05%, Val Loss: 0.6231, Val Acc: 77.69%
Epoch 2/5, Train Loss: 0.4109, Train Acc: 85.36%, Val Loss: 0.3408, Val Acc: 88.29%
Epoch 3/5, Train Loss: 0.2401, Train Acc: 91.48%, Val Loss: 0.2563, Val Acc: 90.85%
Epoch 4/5, Train Loss: 0.1622, Train Acc: 94.51%, Val Loss: 0.2218, Val Acc: 92.35%
Epoch 5/5, Train Loss: 0.1154, Train Acc: 96.01%, Val Loss: 0.2089, Val Acc: 93.25%

Trying LoRA params: r=8, alpha=16, dropout=0.1
Epoch 1/5, Train Loss: 1.1728, Train Acc: 56.56%, Val Loss: 0.4783, Val Acc: 81.94%
Epoch 2/5, Train Loss: 0.3340, Train Acc: 87.93%, Val Loss: 0.2995, Val Acc: 89.54%
Epoch 3/5, Train Loss: 0.2009, Train Acc: 92.81%, Val Loss: 0.2458, Val Acc: 91.35%
Epoch 4/5, Train Loss: 0.1386, Train Acc: 95.36%, Val Loss: 0.2207, Val Acc: 92.15%
Epoch 5/5, Train Loss: 0.0920, Train Acc: 96.96%, Val Loss: 0.2166, Val Acc: 93.15%

Trying LoRA params: r=8, alpha=32, dropout=0.1
Epoch 1/5, Train Loss: 1.0307, Train Acc: 60.61%, Val Loss: 0.3937, Val Acc: 85.64%
Epoch 2/5, Train Loss: 0.2662, Train Acc: 90.68%, Val Loss: 0.2625, Val Acc: 90.60%
Epoch 3/5, Train Loss: 0.1494, Train Acc: 94.78%, Val Loss: 0.1978, Val Acc: 93.20%
Epoch 4/5, Train Loss: 0.1020, Train Acc: 96.32%, Val Loss: 0.2125, Val Acc: 92.85%
Epoch 5/5, Train Loss: 0.0633, Train Acc: 98.06%, Val Loss: 0.1786, Val Acc: 94.75%

Trying LoRA params: r=16, alpha=8, dropout=0.1
Epoch 1/5, Train Loss: 1.4943, Train Acc: 42.05%, Val Loss: 0.7379, Val Acc: 74.89%
Epoch 2/5, Train Loss: 0.4760, Train Acc: 83.43%, Val Loss: 0.4091, Val Acc: 85.14%
Epoch 3/5, Train Loss: 0.2892, Train Acc: 89.65%, Val Loss: 0.3024, Val Acc: 88.49%
Epoch 4/5, Train Loss: 0.2018, Train Acc: 92.93%, Val Loss: 0.2451, Val Acc: 91.45%
Epoch 5/5, Train Loss: 0.1470, Train Acc: 94.86%, Val Loss: 0.2290, Val Acc: 91.85%

Trying LoRA params: r=16, alpha=16, dropout=0.1
Epoch 1/5, Train Loss: 1.2106, Train Acc: 54.27%, Val Loss: 0.4750, Val Acc: 83.54%
Epoch 2/5, Train Loss: 0.3424, Train Acc: 88.21%, Val Loss: 0.2949, Val Acc: 89.59%
Epoch 3/5, Train Loss: 0.2118, Train Acc: 92.51%, Val Loss: 0.2481, Val Acc: 90.80%
Epoch 4/5, Train Loss: 0.1410, Train Acc: 94.99%, Val Loss: 0.2584, Val Acc: 90.60%
Epoch 5/5, Train Loss: 0.1038, Train Acc: 96.51%, Val Loss: 0.1954, Val Acc: 93.25%

Trying LoRA params: r=16, alpha=32, dropout=0.1
Epoch 1/5, Train Loss: 1.0100, Train Acc: 61.51%, Val Loss: 0.4228, Val Acc: 84.39%
Epoch 2/5, Train Loss: 0.2992, Train Acc: 89.18%, Val Loss: 0.2908, Val Acc: 89.74%
Epoch 3/5, Train Loss: 0.1717, Train Acc: 94.31%, Val Loss: 0.2226, Val Acc: 92.50%
Epoch 4/5, Train Loss: 0.1022, Train Acc: 96.50%, Val Loss: 0.2009, Val Acc: 93.20%
Epoch 5/5, Train Loss: 0.0654, Train Acc: 97.94%, Val Loss: 0.1925, Val Acc: 93.80%

Best LoRA hyperparameters for PACS:
Best LoRA params: {'r': 8, 'alpha': 32, 'dropout': 0.1}
Best LoRA validation accuracy: 94.75%
Best model with LoRA saved to /leonardo_scratch/fast/IscrC_FoundCL/cl/lora-CL/ratatouille/ood/exp_outs/best_model_PACS_with_lora.pth
