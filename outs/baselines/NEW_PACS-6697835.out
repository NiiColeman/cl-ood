
--- Run 1/3 ---

Running LoRA with TIES experiment
Test domain: cartoon
Train domains: ['sketch', 'art_painting', 'photo']
Baseline Epoch 1/10, Train Loss: 1.7281, Train Accuracy: 0.00%
Val Loss: 2.4061, Val Accuracy: 6.25%
Baseline Epoch 2/10, Train Loss: 0.5999, Train Accuracy: 100.00%
Val Loss: 2.4052, Val Accuracy: 9.38%
Baseline Epoch 3/10, Train Loss: 0.2717, Train Accuracy: 100.00%
Val Loss: 2.4629, Val Accuracy: 6.25%
Baseline Epoch 4/10, Train Loss: 0.0877, Train Accuracy: 100.00%
Val Loss: 2.5540, Val Accuracy: 9.38%
Baseline Epoch 5/10, Train Loss: 0.0339, Train Accuracy: 100.00%
Val Loss: 2.6591, Val Accuracy: 9.38%
Baseline Epoch 6/10, Train Loss: 0.0176, Train Accuracy: 100.00%
Val Loss: 2.7712, Val Accuracy: 12.50%
Baseline Epoch 7/10, Train Loss: 0.0098, Train Accuracy: 100.00%
Val Loss: 2.8836, Val Accuracy: 12.50%
Baseline Epoch 8/10, Train Loss: 0.0056, Train Accuracy: 100.00%
Val Loss: 2.9933, Val Accuracy: 15.62%
Baseline Epoch 9/10, Train Loss: 0.0033, Train Accuracy: 100.00%
Val Loss: 3.0985, Val Accuracy: 18.75%
Baseline Epoch 10/10, Train Loss: 0.0020, Train Accuracy: 100.00%
Val Loss: 3.1982, Val Accuracy: 18.75%
Baseline Model - Final Test Accuracy: 18.75%

Training LoRA adapter for domain: sketch

Training LoRA adapter for domain: sketch
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 2.2214, Train Accuracy: 28.57%
Val Loss: 2.2491, Val Accuracy: 14.29%
Epoch 2/10, Train Loss: 2.1428, Train Accuracy: 25.00%
Val Loss: 2.1708, Val Accuracy: 14.29%
Epoch 3/10, Train Loss: 2.0639, Train Accuracy: 25.00%
Val Loss: 2.0980, Val Accuracy: 14.29%
Epoch 4/10, Train Loss: 1.9832, Train Accuracy: 25.00%
Val Loss: 2.0321, Val Accuracy: 14.29%
Epoch 5/10, Train Loss: 1.9034, Train Accuracy: 25.00%
Val Loss: 1.9697, Val Accuracy: 14.29%
Epoch 6/10, Train Loss: 1.8286, Train Accuracy: 25.00%
Val Loss: 1.9085, Val Accuracy: 14.29%
Epoch 7/10, Train Loss: 1.7585, Train Accuracy: 28.57%
Val Loss: 1.8541, Val Accuracy: 14.29%
Epoch 8/10, Train Loss: 1.6981, Train Accuracy: 35.71%
Val Loss: 1.8083, Val Accuracy: 14.29%
Epoch 9/10, Train Loss: 1.6420, Train Accuracy: 46.43%
Val Loss: 1.7691, Val Accuracy: 28.57%
Epoch 10/10, Train Loss: 1.5835, Train Accuracy: 53.57%
Val Loss: 1.7362, Val Accuracy: 28.57%
Best validation accuracy for sketch: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
sketch adapter trained. Validation Accuracy: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: art_painting

Training LoRA adapter for domain: art_painting
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 2.3278, Train Accuracy: 14.29%
Val Loss: 2.0378, Val Accuracy: 28.57%
Epoch 2/10, Train Loss: 2.2262, Train Accuracy: 14.29%
Val Loss: 2.0325, Val Accuracy: 28.57%
Epoch 3/10, Train Loss: 2.1487, Train Accuracy: 17.86%
Val Loss: 2.0281, Val Accuracy: 28.57%
Epoch 4/10, Train Loss: 2.0698, Train Accuracy: 17.86%
Val Loss: 2.0224, Val Accuracy: 28.57%
Epoch 5/10, Train Loss: 1.9899, Train Accuracy: 17.86%
Val Loss: 2.0129, Val Accuracy: 28.57%
Epoch 6/10, Train Loss: 1.9110, Train Accuracy: 21.43%
Val Loss: 2.0018, Val Accuracy: 28.57%
Epoch 7/10, Train Loss: 1.8306, Train Accuracy: 21.43%
Val Loss: 1.9906, Val Accuracy: 28.57%
Epoch 8/10, Train Loss: 1.7507, Train Accuracy: 28.57%
Val Loss: 1.9793, Val Accuracy: 28.57%
Epoch 9/10, Train Loss: 1.6707, Train Accuracy: 32.14%
Val Loss: 1.9690, Val Accuracy: 28.57%
Epoch 10/10, Train Loss: 1.5924, Train Accuracy: 39.29%
Val Loss: 1.9604, Val Accuracy: 28.57%
Best validation accuracy for art_painting: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
art_painting adapter trained. Validation Accuracy: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: photo

Training LoRA adapter for domain: photo
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.9867, Train Accuracy: 28.57%
Val Loss: 2.3492, Val Accuracy: 0.00%
Epoch 2/10, Train Loss: 1.9434, Train Accuracy: 28.57%
Val Loss: 2.3275, Val Accuracy: 0.00%
Epoch 3/10, Train Loss: 1.8952, Train Accuracy: 28.57%
Val Loss: 2.3064, Val Accuracy: 0.00%
Epoch 4/10, Train Loss: 1.8428, Train Accuracy: 32.14%
Val Loss: 2.2863, Val Accuracy: 0.00%
Epoch 5/10, Train Loss: 1.8005, Train Accuracy: 32.14%
Val Loss: 2.2664, Val Accuracy: 0.00%
Epoch 6/10, Train Loss: 1.7513, Train Accuracy: 32.14%
Val Loss: 2.2452, Val Accuracy: 0.00%
Epoch 7/10, Train Loss: 1.7011, Train Accuracy: 39.29%
Val Loss: 2.2236, Val Accuracy: 0.00%
Epoch 8/10, Train Loss: 1.6551, Train Accuracy: 42.86%
Val Loss: 2.2012, Val Accuracy: 0.00%
Epoch 9/10, Train Loss: 1.6044, Train Accuracy: 46.43%
Val Loss: 2.1759, Val Accuracy: 0.00%
Epoch 10/10, Train Loss: 1.5525, Train Accuracy: 46.43%
Val Loss: 2.1493, Val Accuracy: 0.00%
Warning: No best state found for domain photo. Using the final state.
Best validation accuracy for photo: 0.00%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
photo adapter trained. Validation Accuracy: 0.00%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Number of trained LoRA adapters: 3

Training coefficients for adapter merging
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Coefficient gradients: tensor([7.3624e-11, 7.3624e-11, 7.3624e-11], device='cuda:0')
Epoch 1, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1596e-11, -8.1596e-11, -8.1596e-11], device='cuda:0')
Epoch 2, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.9861e-12, -3.9861e-12, -3.9861e-12], device='cuda:0')
Epoch 3, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1597e-11, -8.1597e-11, -8.1597e-11], device='cuda:0')
Epoch 4, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([7.3624e-11, 7.3624e-11, 7.3624e-11], device='cuda:0')
Epoch 5, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1597e-11, -8.1597e-11, -8.1597e-11], device='cuda:0')
Epoch 6, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1596e-11, -8.1596e-11, -8.1596e-11], device='cuda:0')
Epoch 7, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([7.3624e-11, 7.3624e-11, 7.3624e-11], device='cuda:0')
Epoch 8, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([7.3624e-11, 7.3624e-11, 7.3624e-11], device='cuda:0')
Epoch 9, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([7.3624e-11, 7.3624e-11, 7.3624e-11], device='cuda:0')
Epoch 10, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Best coefficient accuracy: 0.00%
Final best coefficients: [0.33333334 0.33333334 0.33333334]

Merged model with TIES - Test Loss: 2.0635, Test Accuracy: 9.38%

--- Run 2/3 ---

Running LoRA with TIES experiment
Test domain: cartoon
Train domains: ['sketch', 'art_painting', 'photo']
Baseline Epoch 1/10, Train Loss: 1.7281, Train Accuracy: 0.00%
Val Loss: 2.4061, Val Accuracy: 6.25%
Baseline Epoch 2/10, Train Loss: 0.5999, Train Accuracy: 100.00%
Val Loss: 2.4052, Val Accuracy: 9.38%
Baseline Epoch 3/10, Train Loss: 0.2717, Train Accuracy: 100.00%
Val Loss: 2.4629, Val Accuracy: 6.25%
Baseline Epoch 4/10, Train Loss: 0.0877, Train Accuracy: 100.00%
Val Loss: 2.5540, Val Accuracy: 9.38%
Baseline Epoch 5/10, Train Loss: 0.0339, Train Accuracy: 100.00%
Val Loss: 2.6591, Val Accuracy: 9.38%
Baseline Epoch 6/10, Train Loss: 0.0176, Train Accuracy: 100.00%
Val Loss: 2.7712, Val Accuracy: 12.50%
Baseline Epoch 7/10, Train Loss: 0.0098, Train Accuracy: 100.00%
Val Loss: 2.8836, Val Accuracy: 12.50%
Baseline Epoch 8/10, Train Loss: 0.0056, Train Accuracy: 100.00%
Val Loss: 2.9933, Val Accuracy: 15.62%
Baseline Epoch 9/10, Train Loss: 0.0033, Train Accuracy: 100.00%
Val Loss: 3.0985, Val Accuracy: 18.75%
Baseline Epoch 10/10, Train Loss: 0.0020, Train Accuracy: 100.00%
Val Loss: 3.1982, Val Accuracy: 18.75%
Baseline Model - Final Test Accuracy: 18.75%

Training LoRA adapter for domain: sketch

Training LoRA adapter for domain: sketch
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 2.2214, Train Accuracy: 28.57%
Val Loss: 2.2491, Val Accuracy: 14.29%
Epoch 2/10, Train Loss: 2.1428, Train Accuracy: 25.00%
Val Loss: 2.1708, Val Accuracy: 14.29%
Epoch 3/10, Train Loss: 2.0639, Train Accuracy: 25.00%
Val Loss: 2.0980, Val Accuracy: 14.29%
Epoch 4/10, Train Loss: 1.9832, Train Accuracy: 25.00%
Val Loss: 2.0321, Val Accuracy: 14.29%
Epoch 5/10, Train Loss: 1.9034, Train Accuracy: 25.00%
Val Loss: 1.9697, Val Accuracy: 14.29%
Epoch 6/10, Train Loss: 1.8286, Train Accuracy: 25.00%
Val Loss: 1.9085, Val Accuracy: 14.29%
Epoch 7/10, Train Loss: 1.7585, Train Accuracy: 28.57%
Val Loss: 1.8541, Val Accuracy: 14.29%
Epoch 8/10, Train Loss: 1.6981, Train Accuracy: 35.71%
Val Loss: 1.8083, Val Accuracy: 14.29%
Epoch 9/10, Train Loss: 1.6420, Train Accuracy: 46.43%
Val Loss: 1.7691, Val Accuracy: 28.57%
Epoch 10/10, Train Loss: 1.5835, Train Accuracy: 53.57%
Val Loss: 1.7362, Val Accuracy: 28.57%
Best validation accuracy for sketch: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
sketch adapter trained. Validation Accuracy: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: art_painting

Training LoRA adapter for domain: art_painting
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 2.3278, Train Accuracy: 14.29%
Val Loss: 2.0378, Val Accuracy: 28.57%
Epoch 2/10, Train Loss: 2.2262, Train Accuracy: 14.29%
Val Loss: 2.0325, Val Accuracy: 28.57%
Epoch 3/10, Train Loss: 2.1487, Train Accuracy: 17.86%
Val Loss: 2.0281, Val Accuracy: 28.57%
Epoch 4/10, Train Loss: 2.0698, Train Accuracy: 17.86%
Val Loss: 2.0224, Val Accuracy: 28.57%
Epoch 5/10, Train Loss: 1.9899, Train Accuracy: 17.86%
Val Loss: 2.0129, Val Accuracy: 28.57%
Epoch 6/10, Train Loss: 1.9110, Train Accuracy: 21.43%
Val Loss: 2.0018, Val Accuracy: 28.57%
Epoch 7/10, Train Loss: 1.8306, Train Accuracy: 21.43%
Val Loss: 1.9906, Val Accuracy: 28.57%
Epoch 8/10, Train Loss: 1.7507, Train Accuracy: 28.57%
Val Loss: 1.9793, Val Accuracy: 28.57%
Epoch 9/10, Train Loss: 1.6706, Train Accuracy: 32.14%
Val Loss: 1.9690, Val Accuracy: 28.57%
Epoch 10/10, Train Loss: 1.5924, Train Accuracy: 39.29%
Val Loss: 1.9604, Val Accuracy: 28.57%
Best validation accuracy for art_painting: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
art_painting adapter trained. Validation Accuracy: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: photo

Training LoRA adapter for domain: photo
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.9867, Train Accuracy: 28.57%
Val Loss: 2.3492, Val Accuracy: 0.00%
Epoch 2/10, Train Loss: 1.9434, Train Accuracy: 28.57%
Val Loss: 2.3275, Val Accuracy: 0.00%
Epoch 3/10, Train Loss: 1.8952, Train Accuracy: 28.57%
Val Loss: 2.3064, Val Accuracy: 0.00%
Epoch 4/10, Train Loss: 1.8428, Train Accuracy: 32.14%
Val Loss: 2.2863, Val Accuracy: 0.00%
Epoch 5/10, Train Loss: 1.8005, Train Accuracy: 32.14%
Val Loss: 2.2664, Val Accuracy: 0.00%
Epoch 6/10, Train Loss: 1.7513, Train Accuracy: 32.14%
Val Loss: 2.2452, Val Accuracy: 0.00%
Epoch 7/10, Train Loss: 1.7011, Train Accuracy: 39.29%
Val Loss: 2.2236, Val Accuracy: 0.00%
Epoch 8/10, Train Loss: 1.6551, Train Accuracy: 42.86%
Val Loss: 2.2012, Val Accuracy: 0.00%
Epoch 9/10, Train Loss: 1.6044, Train Accuracy: 46.43%
Val Loss: 2.1759, Val Accuracy: 0.00%
Epoch 10/10, Train Loss: 1.5525, Train Accuracy: 46.43%
Val Loss: 2.1493, Val Accuracy: 0.00%
Warning: No best state found for domain photo. Using the final state.
Best validation accuracy for photo: 0.00%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
photo adapter trained. Validation Accuracy: 0.00%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Number of trained LoRA adapters: 3

Training coefficients for adapter merging
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Coefficient gradients: tensor([-3.9906e-12, -3.9906e-12, -3.9906e-12], device='cuda:0')
Epoch 1, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.9910e-12, -3.9910e-12, -3.9910e-12], device='cuda:0')
Epoch 2, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.9906e-12, -3.9906e-12, -3.9906e-12], device='cuda:0')
Epoch 3, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1601e-11, -8.1601e-11, -8.1601e-11], device='cuda:0')
Epoch 4, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.9908e-12, -3.9908e-12, -3.9908e-12], device='cuda:0')
Epoch 5, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1601e-11, -8.1601e-11, -8.1601e-11], device='cuda:0')
Epoch 6, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.9910e-12, -3.9910e-12, -3.9910e-12], device='cuda:0')
Epoch 7, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.9906e-12, -3.9906e-12, -3.9906e-12], device='cuda:0')
Epoch 8, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.9908e-12, -3.9908e-12, -3.9908e-12], device='cuda:0')
Epoch 9, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([7.3619e-11, 7.3619e-11, 7.3619e-11], device='cuda:0')
Epoch 10, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Best coefficient accuracy: 0.00%
Final best coefficients: [0.33333334 0.33333334 0.33333334]

Merged model with TIES - Test Loss: 2.0635, Test Accuracy: 9.38%

--- Run 3/3 ---

Running LoRA with TIES experiment
Test domain: cartoon
Train domains: ['sketch', 'art_painting', 'photo']
Baseline Epoch 1/10, Train Loss: 1.7281, Train Accuracy: 0.00%
Val Loss: 2.4061, Val Accuracy: 6.25%
Baseline Epoch 2/10, Train Loss: 0.5999, Train Accuracy: 100.00%
Val Loss: 2.4052, Val Accuracy: 9.38%
Baseline Epoch 3/10, Train Loss: 0.2717, Train Accuracy: 100.00%
Val Loss: 2.4629, Val Accuracy: 6.25%
Baseline Epoch 4/10, Train Loss: 0.0877, Train Accuracy: 100.00%
Val Loss: 2.5540, Val Accuracy: 9.38%
Baseline Epoch 5/10, Train Loss: 0.0339, Train Accuracy: 100.00%
Val Loss: 2.6591, Val Accuracy: 9.38%
Baseline Epoch 6/10, Train Loss: 0.0176, Train Accuracy: 100.00%
Val Loss: 2.7712, Val Accuracy: 12.50%
Baseline Epoch 7/10, Train Loss: 0.0098, Train Accuracy: 100.00%
Val Loss: 2.8836, Val Accuracy: 12.50%
Baseline Epoch 8/10, Train Loss: 0.0056, Train Accuracy: 100.00%
Val Loss: 2.9933, Val Accuracy: 15.62%
Baseline Epoch 9/10, Train Loss: 0.0033, Train Accuracy: 100.00%
Val Loss: 3.0985, Val Accuracy: 18.75%
Baseline Epoch 10/10, Train Loss: 0.0020, Train Accuracy: 100.00%
Val Loss: 3.1982, Val Accuracy: 18.75%
Baseline Model - Final Test Accuracy: 18.75%

Training LoRA adapter for domain: sketch

Training LoRA adapter for domain: sketch
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 2.2214, Train Accuracy: 28.57%
Val Loss: 2.2491, Val Accuracy: 14.29%
Epoch 2/10, Train Loss: 2.1428, Train Accuracy: 25.00%
Val Loss: 2.1708, Val Accuracy: 14.29%
Epoch 3/10, Train Loss: 2.0639, Train Accuracy: 25.00%
Val Loss: 2.0980, Val Accuracy: 14.29%
Epoch 4/10, Train Loss: 1.9832, Train Accuracy: 25.00%
Val Loss: 2.0321, Val Accuracy: 14.29%
Epoch 5/10, Train Loss: 1.9034, Train Accuracy: 25.00%
Val Loss: 1.9697, Val Accuracy: 14.29%
Epoch 6/10, Train Loss: 1.8286, Train Accuracy: 25.00%
Val Loss: 1.9085, Val Accuracy: 14.29%
Epoch 7/10, Train Loss: 1.7585, Train Accuracy: 28.57%
Val Loss: 1.8541, Val Accuracy: 14.29%
Epoch 8/10, Train Loss: 1.6981, Train Accuracy: 35.71%
Val Loss: 1.8083, Val Accuracy: 14.29%
Epoch 9/10, Train Loss: 1.6420, Train Accuracy: 46.43%
Val Loss: 1.7691, Val Accuracy: 28.57%
Epoch 10/10, Train Loss: 1.5835, Train Accuracy: 53.57%
Val Loss: 1.7362, Val Accuracy: 28.57%
Best validation accuracy for sketch: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
sketch adapter trained. Validation Accuracy: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: art_painting

Training LoRA adapter for domain: art_painting
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 2.3278, Train Accuracy: 14.29%
Val Loss: 2.0378, Val Accuracy: 28.57%
Epoch 2/10, Train Loss: 2.2262, Train Accuracy: 14.29%
Val Loss: 2.0325, Val Accuracy: 28.57%
Epoch 3/10, Train Loss: 2.1487, Train Accuracy: 17.86%
Val Loss: 2.0281, Val Accuracy: 28.57%
Epoch 4/10, Train Loss: 2.0698, Train Accuracy: 17.86%
Val Loss: 2.0224, Val Accuracy: 28.57%
Epoch 5/10, Train Loss: 1.9899, Train Accuracy: 17.86%
Val Loss: 2.0129, Val Accuracy: 28.57%
Epoch 6/10, Train Loss: 1.9110, Train Accuracy: 21.43%
Val Loss: 2.0018, Val Accuracy: 28.57%
Epoch 7/10, Train Loss: 1.8306, Train Accuracy: 21.43%
Val Loss: 1.9906, Val Accuracy: 28.57%
Epoch 8/10, Train Loss: 1.7507, Train Accuracy: 28.57%
Val Loss: 1.9793, Val Accuracy: 28.57%
Epoch 9/10, Train Loss: 1.6706, Train Accuracy: 32.14%
Val Loss: 1.9690, Val Accuracy: 28.57%
Epoch 10/10, Train Loss: 1.5924, Train Accuracy: 39.29%
Val Loss: 1.9604, Val Accuracy: 28.57%
Best validation accuracy for art_painting: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
art_painting adapter trained. Validation Accuracy: 28.57%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: photo

Training LoRA adapter for domain: photo
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.9867, Train Accuracy: 28.57%
Val Loss: 2.3492, Val Accuracy: 0.00%
Epoch 2/10, Train Loss: 1.9434, Train Accuracy: 28.57%
Val Loss: 2.3275, Val Accuracy: 0.00%
Epoch 3/10, Train Loss: 1.8952, Train Accuracy: 28.57%
Val Loss: 2.3064, Val Accuracy: 0.00%
Epoch 4/10, Train Loss: 1.8428, Train Accuracy: 32.14%
Val Loss: 2.2864, Val Accuracy: 0.00%
Epoch 5/10, Train Loss: 1.8005, Train Accuracy: 32.14%
Val Loss: 2.2664, Val Accuracy: 0.00%
Epoch 6/10, Train Loss: 1.7513, Train Accuracy: 32.14%
Val Loss: 2.2452, Val Accuracy: 0.00%
Epoch 7/10, Train Loss: 1.7011, Train Accuracy: 39.29%
Val Loss: 2.2236, Val Accuracy: 0.00%
Epoch 8/10, Train Loss: 1.6551, Train Accuracy: 42.86%
Val Loss: 2.2012, Val Accuracy: 0.00%
Epoch 9/10, Train Loss: 1.6044, Train Accuracy: 46.43%
Val Loss: 2.1759, Val Accuracy: 0.00%
Epoch 10/10, Train Loss: 1.5525, Train Accuracy: 46.43%
Val Loss: 2.1493, Val Accuracy: 0.00%
Warning: No best state found for domain photo. Using the final state.
Best validation accuracy for photo: 0.00%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
photo adapter trained. Validation Accuracy: 0.00%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Number of trained LoRA adapters: 3

Training coefficients for adapter merging
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Coefficient gradients: tensor([-8.1599e-11, -8.1599e-11, -8.1599e-11], device='cuda:0')
Epoch 1, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1599e-11, -8.1599e-11, -8.1599e-11], device='cuda:0')
Epoch 2, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1599e-11, -8.1599e-11, -8.1599e-11], device='cuda:0')
Epoch 3, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([7.3622e-11, 7.3622e-11, 7.3622e-11], device='cuda:0')
Epoch 4, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.9887e-12, -3.9887e-12, -3.9887e-12], device='cuda:0')
Epoch 5, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([7.3622e-11, 7.3622e-11, 7.3622e-11], device='cuda:0')
Epoch 6, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1599e-11, -8.1599e-11, -8.1599e-11], device='cuda:0')
Epoch 7, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1599e-11, -8.1599e-11, -8.1599e-11], device='cuda:0')
Epoch 8, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.9887e-12, -3.9887e-12, -3.9887e-12], device='cuda:0')
Epoch 9, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.9888e-12, -3.9888e-12, -3.9888e-12], device='cuda:0')
Epoch 10, Loss: 1.6149, Accuracy: 0.00%
Coefficients: [0.33333334 0.33333334 0.33333334]
Best coefficient accuracy: 0.00%
Final best coefficients: [0.33333334 0.33333334 0.33333334]

Merged model with TIES - Test Loss: 2.0635, Test Accuracy: 9.38%

Summary of All Runs:
Baseline Model Accuracy: 18.75% ± 0.00%
Merged Model Accuracy: 9.38% ± 0.00%
Average Coefficients:
  sketch: 0.3333 ± 0.0000
  art_painting: 0.3333 ± 0.0000
  photo: 0.3333 ± 0.0000
