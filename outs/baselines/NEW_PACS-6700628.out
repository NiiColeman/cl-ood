
--- Run 1/3 ---

Running LoRA with TIES experiment
Test domain: cartoon
Train domains: ['photo', 'art_painting', 'sketch']
Baseline Epoch 1/10, Train Loss: 1.9256, Train Accuracy: 20.94%
Val Loss: 1.5442, Val Accuracy: 42.18%
Baseline Epoch 2/10, Train Loss: 1.0251, Train Accuracy: 67.09%
Val Loss: 1.0646, Val Accuracy: 63.60%
Baseline Epoch 3/10, Train Loss: 0.4749, Train Accuracy: 87.61%
Val Loss: 0.7574, Val Accuracy: 75.02%
Baseline Epoch 4/10, Train Loss: 0.1716, Train Accuracy: 97.01%
Val Loss: 0.6073, Val Accuracy: 80.43%
Baseline Epoch 5/10, Train Loss: 0.0472, Train Accuracy: 100.00%
Val Loss: 0.5425, Val Accuracy: 82.09%
Baseline Epoch 6/10, Train Loss: 0.0151, Train Accuracy: 100.00%
Val Loss: 0.5305, Val Accuracy: 82.27%
Baseline Epoch 7/10, Train Loss: 0.0076, Train Accuracy: 100.00%
Val Loss: 0.5270, Val Accuracy: 82.09%
Baseline Epoch 8/10, Train Loss: 0.0051, Train Accuracy: 100.00%
Val Loss: 0.5133, Val Accuracy: 82.51%
Baseline Epoch 9/10, Train Loss: 0.0036, Train Accuracy: 100.00%
Val Loss: 0.5060, Val Accuracy: 82.94%
Baseline Epoch 10/10, Train Loss: 0.0029, Train Accuracy: 100.00%
Val Loss: 0.5048, Val Accuracy: 82.61%
Baseline Model - Final Test Accuracy: 82.61%

Training LoRA adapter for domain: photo

Training LoRA adapter for domain: photo
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.6475, Train Accuracy: 39.52%
Val Loss: 0.9075, Val Accuracy: 77.25%
Epoch 2/10, Train Loss: 0.5237, Train Accuracy: 89.60%
Val Loss: 0.1768, Val Accuracy: 97.60%
Epoch 3/10, Train Loss: 0.0768, Train Accuracy: 98.80%
Val Loss: 0.0473, Val Accuracy: 98.80%
Epoch 4/10, Train Loss: 0.0176, Train Accuracy: 100.00%
Val Loss: 0.0239, Val Accuracy: 99.10%
Epoch 5/10, Train Loss: 0.0066, Train Accuracy: 100.00%
Val Loss: 0.0180, Val Accuracy: 99.40%
Epoch 6/10, Train Loss: 0.0034, Train Accuracy: 100.00%
Val Loss: 0.0180, Val Accuracy: 99.40%
Epoch 7/10, Train Loss: 0.0023, Train Accuracy: 100.00%
Val Loss: 0.0176, Val Accuracy: 99.40%
Epoch 8/10, Train Loss: 0.0017, Train Accuracy: 100.00%
Val Loss: 0.0149, Val Accuracy: 99.40%
Epoch 9/10, Train Loss: 0.0013, Train Accuracy: 100.00%
Val Loss: 0.0138, Val Accuracy: 99.40%
Epoch 10/10, Train Loss: 0.0011, Train Accuracy: 100.00%
Val Loss: 0.0136, Val Accuracy: 99.40%
Best validation accuracy for photo: 99.40%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
photo adapter trained. Validation Accuracy: 99.40%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: art_painting

Training LoRA adapter for domain: art_painting
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.7577, Train Accuracy: 33.88%
Val Loss: 1.1490, Val Accuracy: 62.93%
Epoch 2/10, Train Loss: 0.6244, Train Accuracy: 83.82%
Val Loss: 0.2969, Val Accuracy: 93.17%
Epoch 3/10, Train Loss: 0.1657, Train Accuracy: 95.97%
Val Loss: 0.1653, Val Accuracy: 95.85%
Epoch 4/10, Train Loss: 0.0608, Train Accuracy: 99.02%
Val Loss: 0.1532, Val Accuracy: 95.37%
Epoch 5/10, Train Loss: 0.0332, Train Accuracy: 99.45%
Val Loss: 0.1026, Val Accuracy: 96.83%
Epoch 6/10, Train Loss: 0.0142, Train Accuracy: 99.88%
Val Loss: 0.1153, Val Accuracy: 97.07%
Epoch 7/10, Train Loss: 0.0073, Train Accuracy: 99.94%
Val Loss: 0.1003, Val Accuracy: 97.32%
Epoch 8/10, Train Loss: 0.0051, Train Accuracy: 100.00%
Val Loss: 0.0948, Val Accuracy: 97.32%
Epoch 9/10, Train Loss: 0.0035, Train Accuracy: 100.00%
Val Loss: 0.0891, Val Accuracy: 97.80%
Epoch 10/10, Train Loss: 0.0026, Train Accuracy: 100.00%
Val Loss: 0.0936, Val Accuracy: 97.07%
Best validation accuracy for art_painting: 97.80%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
art_painting adapter trained. Validation Accuracy: 97.80%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: sketch

Training LoRA adapter for domain: sketch
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.3250, Train Accuracy: 48.86%
Val Loss: 0.9089, Val Accuracy: 62.96%
Epoch 2/10, Train Loss: 0.7328, Train Accuracy: 70.94%
Val Loss: 0.8132, Val Accuracy: 66.79%
Epoch 3/10, Train Loss: 0.5619, Train Accuracy: 78.24%
Val Loss: 0.6028, Val Accuracy: 75.18%
Epoch 4/10, Train Loss: 0.4210, Train Accuracy: 84.22%
Val Loss: 0.4906, Val Accuracy: 80.84%
Epoch 5/10, Train Loss: 0.3281, Train Accuracy: 87.91%
Val Loss: 0.4351, Val Accuracy: 82.85%
Epoch 6/10, Train Loss: 0.2631, Train Accuracy: 90.60%
Val Loss: 0.3947, Val Accuracy: 84.31%
Epoch 7/10, Train Loss: 0.2149, Train Accuracy: 92.38%
Val Loss: 0.4334, Val Accuracy: 83.21%
Epoch 8/10, Train Loss: 0.1698, Train Accuracy: 94.75%
Val Loss: 0.4205, Val Accuracy: 84.31%
Epoch 9/10, Train Loss: 0.1173, Train Accuracy: 96.94%
Val Loss: 0.3853, Val Accuracy: 85.77%
Epoch 10/10, Train Loss: 0.0981, Train Accuracy: 97.13%
Val Loss: 0.3591, Val Accuracy: 88.32%
Best validation accuracy for sketch: 88.32%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
sketch adapter trained. Validation Accuracy: 88.32%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Number of trained LoRA adapters: 3

Evaluating individual LoRA adapters on the test domain:
Created LoRA model: <class 'peft.peft_model.PeftModel'>
photo adapter - Test Loss: 2.9016, Test Accuracy: 33.32%
Created LoRA model: <class 'peft.peft_model.PeftModel'>
art_painting adapter - Test Loss: 1.0564, Test Accuracy: 69.81%
Created LoRA model: <class 'peft.peft_model.PeftModel'>
sketch adapter - Test Loss: 1.8101, Test Accuracy: 39.24%

Training coefficients for adapter merging
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Coefficient gradients: tensor([3.2342e-09, 3.2342e-09, 3.2342e-09], device='cuda:0')
Coefficient gradients: tensor([1.5725e-09, 1.5725e-09, 1.5725e-09], device='cuda:0')
Coefficient gradients: tensor([-4.3456e-09, -4.3456e-09, -4.3456e-09], device='cuda:0')
Coefficient gradients: tensor([1.6998e-09, 1.6998e-09, 1.6998e-09], device='cuda:0')
Coefficient gradients: tensor([-7.6343e-09, -7.6343e-09, -7.6343e-09], device='cuda:0')
Coefficient gradients: tensor([1.1289e-09, 1.1289e-09, 1.1289e-09], device='cuda:0')
Coefficient gradients: tensor([-5.9895e-09, -5.9895e-09, -5.9895e-09], device='cuda:0')
Coefficient gradients: tensor([-8.7783e-09, -8.7783e-09, -8.7783e-09], device='cuda:0')
Epoch 1, Loss: 1.8822, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-2.6733e-09, -2.6733e-09, -2.6733e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8222e-09, -1.8222e-09, -1.8222e-09], device='cuda:0')
Coefficient gradients: tensor([-7.7727e-09, -7.7727e-09, -7.7727e-09], device='cuda:0')
Coefficient gradients: tensor([1.2776e-09, 1.2776e-09, 1.2776e-09], device='cuda:0')
Coefficient gradients: tensor([7.9837e-10, 7.9837e-10, 7.9837e-10], device='cuda:0')
Coefficient gradients: tensor([-1.8438e-08, -1.8438e-08, -1.8438e-08], device='cuda:0')
Coefficient gradients: tensor([-2.0148e-09, -2.0148e-09, -2.0148e-09], device='cuda:0')
Coefficient gradients: tensor([-7.3610e-09, -7.3610e-09, -7.3610e-09], device='cuda:0')
Epoch 2, Loss: 1.8709, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-6.0510e-09, -6.0510e-09, -6.0510e-09], device='cuda:0')
Coefficient gradients: tensor([-1.6052e-09, -1.6052e-09, -1.6052e-09], device='cuda:0')
Coefficient gradients: tensor([-2.7155e-10, -2.7155e-10, -2.7155e-10], device='cuda:0')
Coefficient gradients: tensor([-5.7052e-09, -5.7052e-09, -5.7052e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8035e-08, -1.8035e-08, -1.8035e-08], device='cuda:0')
Coefficient gradients: tensor([-1.0577e-08, -1.0577e-08, -1.0577e-08], device='cuda:0')
Coefficient gradients: tensor([-7.5244e-09, -7.5244e-09, -7.5244e-09], device='cuda:0')
Coefficient gradients: tensor([-1.9677e-08, -1.9677e-08, -1.9677e-08], device='cuda:0')
Epoch 3, Loss: 1.8760, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.7444e-08, -1.7444e-08, -1.7444e-08], device='cuda:0')
Coefficient gradients: tensor([1.4071e-09, 1.4071e-09, 1.4071e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1093e-08, -1.1093e-08, -1.1093e-08], device='cuda:0')
Coefficient gradients: tensor([-8.4235e-09, -8.4235e-09, -8.4235e-09], device='cuda:0')
Coefficient gradients: tensor([-4.5084e-09, -4.5084e-09, -4.5084e-09], device='cuda:0')
Coefficient gradients: tensor([4.4710e-10, 4.4710e-10, 4.4710e-10], device='cuda:0')
Coefficient gradients: tensor([-3.1694e-10, -3.1694e-10, -3.1694e-10], device='cuda:0')
Coefficient gradients: tensor([5.0107e-10, 5.0107e-10, 5.0107e-10], device='cuda:0')
Epoch 4, Loss: 1.8801, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.1382e-08, -1.1382e-08, -1.1382e-08], device='cuda:0')
Coefficient gradients: tensor([-1.8425e-08, -1.8425e-08, -1.8425e-08], device='cuda:0')
Coefficient gradients: tensor([-5.1423e-09, -5.1423e-09, -5.1423e-09], device='cuda:0')
Coefficient gradients: tensor([-6.3230e-09, -6.3230e-09, -6.3230e-09], device='cuda:0')
Coefficient gradients: tensor([-8.2634e-09, -8.2634e-09, -8.2634e-09], device='cuda:0')
Coefficient gradients: tensor([2.7030e-09, 2.7030e-09, 2.7030e-09], device='cuda:0')
Coefficient gradients: tensor([-7.7750e-09, -7.7750e-09, -7.7750e-09], device='cuda:0')
Coefficient gradients: tensor([9.7133e-09, 9.7133e-09, 9.7133e-09], device='cuda:0')
Epoch 5, Loss: 1.8744, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-5.1724e-10, -5.1724e-10, -5.1724e-10], device='cuda:0')
Coefficient gradients: tensor([-9.6303e-09, -9.6303e-09, -9.6303e-09], device='cuda:0')
Coefficient gradients: tensor([3.4962e-09, 3.4962e-09, 3.4962e-09], device='cuda:0')
Coefficient gradients: tensor([-4.8632e-09, -4.8632e-09, -4.8632e-09], device='cuda:0')
Coefficient gradients: tensor([-8.1465e-09, -8.1465e-09, -8.1465e-09], device='cuda:0')
Coefficient gradients: tensor([-3.0650e-09, -3.0650e-09, -3.0650e-09], device='cuda:0')
Coefficient gradients: tensor([9.4441e-09, 9.4441e-09, 9.4441e-09], device='cuda:0')
Coefficient gradients: tensor([8.6024e-09, 8.6024e-09, 8.6024e-09], device='cuda:0')
Epoch 6, Loss: 1.9138, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-7.5744e-09, -7.5744e-09, -7.5744e-09], device='cuda:0')
Coefficient gradients: tensor([-1.4542e-09, -1.4542e-09, -1.4542e-09], device='cuda:0')
Coefficient gradients: tensor([-9.1027e-09, -9.1027e-09, -9.1027e-09], device='cuda:0')
Coefficient gradients: tensor([-7.9732e-09, -7.9732e-09, -7.9732e-09], device='cuda:0')
Coefficient gradients: tensor([-2.8865e-10, -2.8865e-10, -2.8865e-10], device='cuda:0')
Coefficient gradients: tensor([-7.2070e-09, -7.2070e-09, -7.2070e-09], device='cuda:0')
Coefficient gradients: tensor([4.2696e-10, 4.2696e-10, 4.2696e-10], device='cuda:0')
Coefficient gradients: tensor([-1.5166e-08, -1.5166e-08, -1.5166e-08], device='cuda:0')
Epoch 7, Loss: 1.9144, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.0304e-09, -1.0304e-09, -1.0304e-09], device='cuda:0')
Coefficient gradients: tensor([-7.7328e-09, -7.7328e-09, -7.7328e-09], device='cuda:0')
Coefficient gradients: tensor([-4.8991e-09, -4.8991e-09, -4.8991e-09], device='cuda:0')
Coefficient gradients: tensor([-8.3128e-09, -8.3128e-09, -8.3128e-09], device='cuda:0')
Coefficient gradients: tensor([-8.7982e-09, -8.7982e-09, -8.7982e-09], device='cuda:0')
Coefficient gradients: tensor([7.8196e-09, 7.8196e-09, 7.8196e-09], device='cuda:0')
Coefficient gradients: tensor([-3.6487e-10, -3.6487e-10, -3.6487e-10], device='cuda:0')
Coefficient gradients: tensor([-1.9973e-09, -1.9973e-09, -1.9973e-09], device='cuda:0')
Epoch 8, Loss: 1.8654, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.6769e-12, -1.6769e-12, -1.6769e-12], device='cuda:0')
Coefficient gradients: tensor([2.4614e-09, 2.4614e-09, 2.4614e-09], device='cuda:0')
Coefficient gradients: tensor([1.8864e-09, 1.8864e-09, 1.8864e-09], device='cuda:0')
Coefficient gradients: tensor([-8.2477e-09, -8.2477e-09, -8.2477e-09], device='cuda:0')
Coefficient gradients: tensor([8.3341e-09, 8.3341e-09, 8.3341e-09], device='cuda:0')
Coefficient gradients: tensor([-1.5085e-09, -1.5085e-09, -1.5085e-09], device='cuda:0')
Coefficient gradients: tensor([-1.9029e-10, -1.9029e-10, -1.9029e-10], device='cuda:0')
Coefficient gradients: tensor([-4.2795e-10, -4.2795e-10, -4.2795e-10], device='cuda:0')
Epoch 9, Loss: 1.8270, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.0862e-09, -8.0862e-09, -8.0862e-09], device='cuda:0')
Coefficient gradients: tensor([3.9785e-09, 3.9785e-09, 3.9785e-09], device='cuda:0')
Coefficient gradients: tensor([-9.0565e-09, -9.0565e-09, -9.0565e-09], device='cuda:0')
Coefficient gradients: tensor([-6.6098e-09, -6.6098e-09, -6.6098e-09], device='cuda:0')
Coefficient gradients: tensor([-4.8333e-10, -4.8333e-10, -4.8333e-10], device='cuda:0')
Coefficient gradients: tensor([8.8315e-09, 8.8315e-09, 8.8315e-09], device='cuda:0')
Coefficient gradients: tensor([5.8066e-10, 5.8066e-10, 5.8066e-10], device='cuda:0')
Coefficient gradients: tensor([-2.1761e-09, -2.1761e-09, -2.1761e-09], device='cuda:0')
Epoch 10, Loss: 1.8767, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.8662e-10, -1.8662e-10, -1.8662e-10], device='cuda:0')
Coefficient gradients: tensor([-3.0753e-10, -3.0753e-10, -3.0753e-10], device='cuda:0')
Coefficient gradients: tensor([-8.0693e-09, -8.0693e-09, -8.0693e-09], device='cuda:0')
Coefficient gradients: tensor([-4.1074e-09, -4.1074e-09, -4.1074e-09], device='cuda:0')
Coefficient gradients: tensor([-4.5947e-09, -4.5947e-09, -4.5947e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1852e-09, -1.1852e-09, -1.1852e-09], device='cuda:0')
Coefficient gradients: tensor([-9.8237e-09, -9.8237e-09, -9.8237e-09], device='cuda:0')
Coefficient gradients: tensor([2.9346e-09, 2.9346e-09, 2.9346e-09], device='cuda:0')
Epoch 11, Loss: 1.8587, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.6487e-09, -1.6487e-09, -1.6487e-09], device='cuda:0')
Coefficient gradients: tensor([1.6584e-10, 1.6584e-10, 1.6584e-10], device='cuda:0')
Coefficient gradients: tensor([-1.8177e-08, -1.8177e-08, -1.8177e-08], device='cuda:0')
Coefficient gradients: tensor([-5.4264e-09, -5.4264e-09, -5.4264e-09], device='cuda:0')
Coefficient gradients: tensor([-9.8559e-09, -9.8559e-09, -9.8559e-09], device='cuda:0')
Coefficient gradients: tensor([-8.0266e-09, -8.0266e-09, -8.0266e-09], device='cuda:0')
Coefficient gradients: tensor([-8.5116e-09, -8.5116e-09, -8.5116e-09], device='cuda:0')
Coefficient gradients: tensor([-4.2680e-09, -4.2680e-09, -4.2680e-09], device='cuda:0')
Epoch 12, Loss: 1.8419, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([1.7509e-09, 1.7509e-09, 1.7509e-09], device='cuda:0')
Coefficient gradients: tensor([-7.6347e-09, -7.6347e-09, -7.6347e-09], device='cuda:0')
Coefficient gradients: tensor([1.1525e-09, 1.1525e-09, 1.1525e-09], device='cuda:0')
Coefficient gradients: tensor([8.3954e-09, 8.3954e-09, 8.3954e-09], device='cuda:0')
Coefficient gradients: tensor([-4.4704e-09, -4.4704e-09, -4.4704e-09], device='cuda:0')
Coefficient gradients: tensor([-8.6318e-09, -8.6318e-09, -8.6318e-09], device='cuda:0')
Coefficient gradients: tensor([-1.5356e-08, -1.5356e-08, -1.5356e-08], device='cuda:0')
Coefficient gradients: tensor([9.6788e-09, 9.6788e-09, 9.6788e-09], device='cuda:0')
Epoch 13, Loss: 1.8811, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.2533e-09, -8.2533e-09, -8.2533e-09], device='cuda:0')
Coefficient gradients: tensor([-7.3817e-09, -7.3817e-09, -7.3817e-09], device='cuda:0')
Coefficient gradients: tensor([-6.5402e-09, -6.5402e-09, -6.5402e-09], device='cuda:0')
Coefficient gradients: tensor([7.3181e-09, 7.3181e-09, 7.3181e-09], device='cuda:0')
Coefficient gradients: tensor([8.7780e-09, 8.7780e-09, 8.7780e-09], device='cuda:0')
Coefficient gradients: tensor([4.9063e-09, 4.9063e-09, 4.9063e-09], device='cuda:0')
Coefficient gradients: tensor([3.8323e-09, 3.8323e-09, 3.8323e-09], device='cuda:0')
Coefficient gradients: tensor([-1.9035e-10, -1.9035e-10, -1.9035e-10], device='cuda:0')
Epoch 14, Loss: 1.8379, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-2.1925e-09, -2.1925e-09, -2.1925e-09], device='cuda:0')
Coefficient gradients: tensor([-9.2361e-09, -9.2361e-09, -9.2361e-09], device='cuda:0')
Coefficient gradients: tensor([-4.6686e-09, -4.6686e-09, -4.6686e-09], device='cuda:0')
Coefficient gradients: tensor([2.9197e-09, 2.9197e-09, 2.9197e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1818e-08, -1.1818e-08, -1.1818e-08], device='cuda:0')
Coefficient gradients: tensor([1.9304e-09, 1.9304e-09, 1.9304e-09], device='cuda:0')
Coefficient gradients: tensor([-2.6703e-09, -2.6703e-09, -2.6703e-09], device='cuda:0')
Coefficient gradients: tensor([-1.5126e-08, -1.5126e-08, -1.5126e-08], device='cuda:0')
Epoch 15, Loss: 1.9416, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-6.7915e-10, -6.7915e-10, -6.7915e-10], device='cuda:0')
Coefficient gradients: tensor([2.6605e-09, 2.6605e-09, 2.6605e-09], device='cuda:0')
Coefficient gradients: tensor([-3.0500e-08, -3.0500e-08, -3.0500e-08], device='cuda:0')
Coefficient gradients: tensor([-2.0202e-09, -2.0202e-09, -2.0202e-09], device='cuda:0')
Coefficient gradients: tensor([2.7581e-10, 2.7581e-10, 2.7581e-10], device='cuda:0')
Coefficient gradients: tensor([-7.5078e-10, -7.5078e-10, -7.5078e-10], device='cuda:0')
Coefficient gradients: tensor([-1.7724e-09, -1.7724e-09, -1.7724e-09], device='cuda:0')
Coefficient gradients: tensor([-3.6272e-08, -3.6272e-08, -3.6272e-08], device='cuda:0')
Epoch 16, Loss: 1.9325, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([1.7450e-09, 1.7450e-09, 1.7450e-09], device='cuda:0')
Coefficient gradients: tensor([-4.4191e-10, -4.4191e-10, -4.4191e-10], device='cuda:0')
Coefficient gradients: tensor([-8.6832e-09, -8.6832e-09, -8.6832e-09], device='cuda:0')
Coefficient gradients: tensor([-1.2164e-08, -1.2164e-08, -1.2164e-08], device='cuda:0')
Coefficient gradients: tensor([-9.3236e-09, -9.3236e-09, -9.3236e-09], device='cuda:0')
Coefficient gradients: tensor([-6.7675e-09, -6.7675e-09, -6.7675e-09], device='cuda:0')
Coefficient gradients: tensor([-7.7670e-09, -7.7670e-09, -7.7670e-09], device='cuda:0')
Coefficient gradients: tensor([-1.3078e-09, -1.3078e-09, -1.3078e-09], device='cuda:0')
Epoch 17, Loss: 1.8504, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.8533e-09, -1.8533e-09, -1.8533e-09], device='cuda:0')
Coefficient gradients: tensor([-1.6730e-08, -1.6730e-08, -1.6730e-08], device='cuda:0')
Coefficient gradients: tensor([-3.0776e-08, -3.0776e-08, -3.0776e-08], device='cuda:0')
Coefficient gradients: tensor([1.6547e-09, 1.6547e-09, 1.6547e-09], device='cuda:0')
Coefficient gradients: tensor([-4.1017e-09, -4.1017e-09, -4.1017e-09], device='cuda:0')
Coefficient gradients: tensor([1.1983e-10, 1.1983e-10, 1.1983e-10], device='cuda:0')
Coefficient gradients: tensor([-8.5735e-09, -8.5735e-09, -8.5735e-09], device='cuda:0')
Coefficient gradients: tensor([-1.7898e-08, -1.7898e-08, -1.7898e-08], device='cuda:0')
Epoch 18, Loss: 1.8801, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.8631e-09, -3.8631e-09, -3.8631e-09], device='cuda:0')
Coefficient gradients: tensor([7.9289e-09, 7.9289e-09, 7.9289e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1508e-09, -1.1508e-09, -1.1508e-09], device='cuda:0')
Coefficient gradients: tensor([-8.7151e-09, -8.7151e-09, -8.7151e-09], device='cuda:0')
Coefficient gradients: tensor([3.1257e-09, 3.1257e-09, 3.1257e-09], device='cuda:0')
Coefficient gradients: tensor([-9.4367e-09, -9.4367e-09, -9.4367e-09], device='cuda:0')
Coefficient gradients: tensor([-4.4386e-09, -4.4386e-09, -4.4386e-09], device='cuda:0')
Coefficient gradients: tensor([-4.7830e-09, -4.7830e-09, -4.7830e-09], device='cuda:0')
Epoch 19, Loss: 1.8445, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-6.1753e-09, -6.1753e-09, -6.1753e-09], device='cuda:0')
Coefficient gradients: tensor([-6.8945e-09, -6.8945e-09, -6.8945e-09], device='cuda:0')
Coefficient gradients: tensor([-5.0709e-09, -5.0709e-09, -5.0709e-09], device='cuda:0')
Coefficient gradients: tensor([-9.4768e-09, -9.4768e-09, -9.4768e-09], device='cuda:0')
Coefficient gradients: tensor([-9.7279e-09, -9.7279e-09, -9.7279e-09], device='cuda:0')
Coefficient gradients: tensor([4.3917e-09, 4.3917e-09, 4.3917e-09], device='cuda:0')
Coefficient gradients: tensor([-9.6964e-09, -9.6964e-09, -9.6964e-09], device='cuda:0')
Coefficient gradients: tensor([-1.6629e-08, -1.6629e-08, -1.6629e-08], device='cuda:0')
Epoch 20, Loss: 1.9194, Accuracy: 36.75%
Coefficients: [0.33333334 0.33333334 0.33333334]
Best coefficient accuracy: 36.75%
Final best coefficients: [0.33333334 0.33333334 0.33333334]

Merged model with TIES - Test Loss: 1.6313, Test Accuracy: 38.10%

--- Run 2/3 ---

Running LoRA with TIES experiment
Test domain: cartoon
Train domains: ['photo', 'art_painting', 'sketch']
Baseline Epoch 1/10, Train Loss: 1.9256, Train Accuracy: 20.94%
Val Loss: 1.5442, Val Accuracy: 42.18%
Baseline Epoch 2/10, Train Loss: 1.0251, Train Accuracy: 67.09%
Val Loss: 1.0646, Val Accuracy: 63.60%
Baseline Epoch 3/10, Train Loss: 0.4749, Train Accuracy: 87.61%
Val Loss: 0.7574, Val Accuracy: 75.02%
Baseline Epoch 4/10, Train Loss: 0.1716, Train Accuracy: 97.01%
Val Loss: 0.6073, Val Accuracy: 80.43%
Baseline Epoch 5/10, Train Loss: 0.0472, Train Accuracy: 100.00%
Val Loss: 0.5425, Val Accuracy: 82.09%
Baseline Epoch 6/10, Train Loss: 0.0151, Train Accuracy: 100.00%
Val Loss: 0.5305, Val Accuracy: 82.27%
Baseline Epoch 7/10, Train Loss: 0.0076, Train Accuracy: 100.00%
Val Loss: 0.5270, Val Accuracy: 82.09%
Baseline Epoch 8/10, Train Loss: 0.0051, Train Accuracy: 100.00%
Val Loss: 0.5133, Val Accuracy: 82.51%
Baseline Epoch 9/10, Train Loss: 0.0036, Train Accuracy: 100.00%
Val Loss: 0.5060, Val Accuracy: 82.94%
Baseline Epoch 10/10, Train Loss: 0.0029, Train Accuracy: 100.00%
Val Loss: 0.5049, Val Accuracy: 82.61%
Baseline Model - Final Test Accuracy: 82.61%

Training LoRA adapter for domain: photo

Training LoRA adapter for domain: photo
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.6474, Train Accuracy: 39.52%
Val Loss: 0.9074, Val Accuracy: 76.95%
Epoch 2/10, Train Loss: 0.5234, Train Accuracy: 89.45%
Val Loss: 0.1780, Val Accuracy: 97.90%
Epoch 3/10, Train Loss: 0.0741, Train Accuracy: 98.88%
Val Loss: 0.0462, Val Accuracy: 98.50%
Epoch 4/10, Train Loss: 0.0172, Train Accuracy: 100.00%
Val Loss: 0.0239, Val Accuracy: 99.40%
Epoch 5/10, Train Loss: 0.0065, Train Accuracy: 100.00%
Val Loss: 0.0178, Val Accuracy: 99.40%
Epoch 6/10, Train Loss: 0.0034, Train Accuracy: 100.00%
Val Loss: 0.0185, Val Accuracy: 99.40%
Epoch 7/10, Train Loss: 0.0022, Train Accuracy: 100.00%
Val Loss: 0.0181, Val Accuracy: 99.40%
Epoch 8/10, Train Loss: 0.0017, Train Accuracy: 100.00%
Val Loss: 0.0154, Val Accuracy: 99.40%
Epoch 9/10, Train Loss: 0.0013, Train Accuracy: 100.00%
Val Loss: 0.0145, Val Accuracy: 99.40%
Epoch 10/10, Train Loss: 0.0011, Train Accuracy: 100.00%
Val Loss: 0.0142, Val Accuracy: 99.40%
Best validation accuracy for photo: 99.40%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
photo adapter trained. Validation Accuracy: 99.40%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: art_painting

Training LoRA adapter for domain: art_painting
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.7576, Train Accuracy: 33.76%
Val Loss: 1.1492, Val Accuracy: 62.93%
Epoch 2/10, Train Loss: 0.6241, Train Accuracy: 83.64%
Val Loss: 0.2971, Val Accuracy: 93.41%
Epoch 3/10, Train Loss: 0.1655, Train Accuracy: 95.85%
Val Loss: 0.1659, Val Accuracy: 95.85%
Epoch 4/10, Train Loss: 0.0610, Train Accuracy: 98.90%
Val Loss: 0.1510, Val Accuracy: 95.61%
Epoch 5/10, Train Loss: 0.0330, Train Accuracy: 99.51%
Val Loss: 0.1024, Val Accuracy: 96.83%
Epoch 6/10, Train Loss: 0.0142, Train Accuracy: 99.88%
Val Loss: 0.1148, Val Accuracy: 96.83%
Epoch 7/10, Train Loss: 0.0073, Train Accuracy: 99.94%
Val Loss: 0.0999, Val Accuracy: 97.32%
Epoch 8/10, Train Loss: 0.0050, Train Accuracy: 100.00%
Val Loss: 0.0938, Val Accuracy: 97.07%
Epoch 9/10, Train Loss: 0.0034, Train Accuracy: 100.00%
Val Loss: 0.0887, Val Accuracy: 97.32%
Epoch 10/10, Train Loss: 0.0026, Train Accuracy: 100.00%
Val Loss: 0.0923, Val Accuracy: 97.07%
Best validation accuracy for art_painting: 97.32%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
art_painting adapter trained. Validation Accuracy: 97.32%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: sketch

Training LoRA adapter for domain: sketch
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.3250, Train Accuracy: 48.86%
Val Loss: 0.9089, Val Accuracy: 62.96%
Epoch 2/10, Train Loss: 0.7328, Train Accuracy: 70.94%
Val Loss: 0.8132, Val Accuracy: 66.79%
Epoch 3/10, Train Loss: 0.5619, Train Accuracy: 78.24%
Val Loss: 0.6028, Val Accuracy: 75.18%
Epoch 4/10, Train Loss: 0.4209, Train Accuracy: 84.17%
Val Loss: 0.4907, Val Accuracy: 80.84%
Epoch 5/10, Train Loss: 0.3282, Train Accuracy: 87.91%
Val Loss: 0.4357, Val Accuracy: 82.85%
Epoch 6/10, Train Loss: 0.2627, Train Accuracy: 90.51%
Val Loss: 0.4033, Val Accuracy: 84.12%
Epoch 7/10, Train Loss: 0.2159, Train Accuracy: 92.20%
Val Loss: 0.4280, Val Accuracy: 83.58%
Epoch 8/10, Train Loss: 0.1699, Train Accuracy: 94.75%
Val Loss: 0.4139, Val Accuracy: 84.31%
Epoch 9/10, Train Loss: 0.1171, Train Accuracy: 97.08%
Val Loss: 0.3875, Val Accuracy: 85.58%
Epoch 10/10, Train Loss: 0.0979, Train Accuracy: 97.22%
Val Loss: 0.3623, Val Accuracy: 87.77%
Best validation accuracy for sketch: 87.77%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
sketch adapter trained. Validation Accuracy: 87.77%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Number of trained LoRA adapters: 3

Evaluating individual LoRA adapters on the test domain:
Created LoRA model: <class 'peft.peft_model.PeftModel'>
photo adapter - Test Loss: 2.9394, Test Accuracy: 32.75%
Created LoRA model: <class 'peft.peft_model.PeftModel'>
art_painting adapter - Test Loss: 1.0586, Test Accuracy: 70.00%
Created LoRA model: <class 'peft.peft_model.PeftModel'>
sketch adapter - Test Loss: 1.8059, Test Accuracy: 39.38%

Training coefficients for adapter merging
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Coefficient gradients: tensor([-6.7173e-09, -6.7173e-09, -6.7173e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8233e-08, -1.8233e-08, -1.8233e-08], device='cuda:0')
Coefficient gradients: tensor([-4.0273e-09, -4.0273e-09, -4.0273e-09], device='cuda:0')
Coefficient gradients: tensor([-7.2042e-10, -7.2042e-10, -7.2042e-10], device='cuda:0')
Coefficient gradients: tensor([-7.7193e-09, -7.7193e-09, -7.7193e-09], device='cuda:0')
Coefficient gradients: tensor([1.1687e-09, 1.1687e-09, 1.1687e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8153e-09, -1.8153e-09, -1.8153e-09], device='cuda:0')
Coefficient gradients: tensor([-8.8408e-09, -8.8408e-09, -8.8408e-09], device='cuda:0')
Epoch 1, Loss: 1.8839, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.2633e-08, -1.2633e-08, -1.2633e-08], device='cuda:0')
Coefficient gradients: tensor([8.0276e-09, 8.0276e-09, 8.0276e-09], device='cuda:0')
Coefficient gradients: tensor([-2.3557e-09, -2.3557e-09, -2.3557e-09], device='cuda:0')
Coefficient gradients: tensor([-8.4722e-09, -8.4722e-09, -8.4722e-09], device='cuda:0')
Coefficient gradients: tensor([-4.2799e-09, -4.2799e-09, -4.2799e-09], device='cuda:0')
Coefficient gradients: tensor([-9.2174e-09, -9.2174e-09, -9.2174e-09], device='cuda:0')
Coefficient gradients: tensor([-2.1497e-09, -2.1497e-09, -2.1497e-09], device='cuda:0')
Coefficient gradients: tensor([-2.3823e-09, -2.3823e-09, -2.3823e-09], device='cuda:0')
Epoch 2, Loss: 1.8717, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.2206e-09, -1.2206e-09, -1.2206e-09], device='cuda:0')
Coefficient gradients: tensor([-1.5121e-09, -1.5121e-09, -1.5121e-09], device='cuda:0')
Coefficient gradients: tensor([-1.0073e-08, -1.0073e-08, -1.0073e-08], device='cuda:0')
Coefficient gradients: tensor([-5.8146e-09, -5.8146e-09, -5.8146e-09], device='cuda:0')
Coefficient gradients: tensor([-8.1357e-09, -8.1357e-09, -8.1357e-09], device='cuda:0')
Coefficient gradients: tensor([-1.0317e-09, -1.0317e-09, -1.0317e-09], device='cuda:0')
Coefficient gradients: tensor([-7.5060e-09, -7.5060e-09, -7.5060e-09], device='cuda:0')
Coefficient gradients: tensor([-9.7612e-09, -9.7612e-09, -9.7612e-09], device='cuda:0')
Epoch 3, Loss: 1.8775, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-2.1995e-09, -2.1995e-09, -2.1995e-09], device='cuda:0')
Coefficient gradients: tensor([-8.4172e-09, -8.4172e-09, -8.4172e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1616e-09, -1.1616e-09, -1.1616e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8564e-08, -1.8564e-08, -1.8564e-08], device='cuda:0')
Coefficient gradients: tensor([4.4101e-10, 4.4101e-10, 4.4101e-10], device='cuda:0')
Coefficient gradients: tensor([-9.3800e-09, -9.3800e-09, -9.3800e-09], device='cuda:0')
Coefficient gradients: tensor([-6.0650e-09, -6.0650e-09, -6.0650e-09], device='cuda:0')
Coefficient gradients: tensor([-9.3811e-09, -9.3811e-09, -9.3811e-09], device='cuda:0')
Epoch 4, Loss: 1.8801, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.4196e-09, -1.4196e-09, -1.4196e-09], device='cuda:0')
Coefficient gradients: tensor([-8.0856e-09, -8.0856e-09, -8.0856e-09], device='cuda:0')
Coefficient gradients: tensor([4.7155e-09, 4.7155e-09, 4.7155e-09], device='cuda:0')
Coefficient gradients: tensor([-6.9787e-09, -6.9787e-09, -6.9787e-09], device='cuda:0')
Coefficient gradients: tensor([1.7822e-09, 1.7822e-09, 1.7822e-09], device='cuda:0')
Coefficient gradients: tensor([-1.7200e-08, -1.7200e-08, -1.7200e-08], device='cuda:0')
Coefficient gradients: tensor([-1.7911e-08, -1.7911e-08, -1.7911e-08], device='cuda:0')
Coefficient gradients: tensor([-3.0044e-08, -3.0044e-08, -3.0044e-08], device='cuda:0')
Epoch 5, Loss: 1.8758, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.8579e-09, -1.8579e-09, -1.8579e-09], device='cuda:0')
Coefficient gradients: tensor([-1.9146e-08, -1.9146e-08, -1.9146e-08], device='cuda:0')
Coefficient gradients: tensor([-6.4007e-09, -6.4007e-09, -6.4007e-09], device='cuda:0')
Coefficient gradients: tensor([-5.5802e-09, -5.5802e-09, -5.5802e-09], device='cuda:0')
Coefficient gradients: tensor([-8.0372e-09, -8.0372e-09, -8.0372e-09], device='cuda:0')
Coefficient gradients: tensor([-3.2512e-09, -3.2512e-09, -3.2512e-09], device='cuda:0')
Coefficient gradients: tensor([-1.0527e-08, -1.0527e-08, -1.0527e-08], device='cuda:0')
Coefficient gradients: tensor([-9.8353e-10, -9.8353e-10, -9.8353e-10], device='cuda:0')
Epoch 6, Loss: 1.9134, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-2.1313e-09, -2.1313e-09, -2.1313e-09], device='cuda:0')
Coefficient gradients: tensor([-1.4989e-09, -1.4989e-09, -1.4989e-09], device='cuda:0')
Coefficient gradients: tensor([-1.9148e-08, -1.9148e-08, -1.9148e-08], device='cuda:0')
Coefficient gradients: tensor([-8.7546e-09, -8.7546e-09, -8.7546e-09], device='cuda:0')
Coefficient gradients: tensor([-2.1317e-10, -2.1317e-10, -2.1317e-10], device='cuda:0')
Coefficient gradients: tensor([-1.7183e-08, -1.7183e-08, -1.7183e-08], device='cuda:0')
Coefficient gradients: tensor([-9.5220e-09, -9.5220e-09, -9.5220e-09], device='cuda:0')
Coefficient gradients: tensor([-1.5129e-08, -1.5129e-08, -1.5129e-08], device='cuda:0')
Epoch 7, Loss: 1.9185, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.2462e-10, -8.2462e-10, -8.2462e-10], device='cuda:0')
Coefficient gradients: tensor([-7.9400e-09, -7.9400e-09, -7.9400e-09], device='cuda:0')
Coefficient gradients: tensor([-4.9192e-09, -4.9192e-09, -4.9192e-09], device='cuda:0')
Coefficient gradients: tensor([2.1466e-09, 2.1466e-09, 2.1466e-09], device='cuda:0')
Coefficient gradients: tensor([-9.6701e-09, -9.6701e-09, -9.6701e-09], device='cuda:0')
Coefficient gradients: tensor([7.9695e-09, 7.9695e-09, 7.9695e-09], device='cuda:0')
Coefficient gradients: tensor([-5.6139e-10, -5.6139e-10, -5.6139e-10], device='cuda:0')
Coefficient gradients: tensor([-2.0497e-09, -2.0497e-09, -2.0497e-09], device='cuda:0')
Epoch 8, Loss: 1.8647, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-2.9892e-08, -2.9892e-08, -2.9892e-08], device='cuda:0')
Coefficient gradients: tensor([-8.2374e-09, -8.2374e-09, -8.2374e-09], device='cuda:0')
Coefficient gradients: tensor([1.7395e-09, 1.7395e-09, 1.7395e-09], device='cuda:0')
Coefficient gradients: tensor([-8.2661e-09, -8.2661e-09, -8.2661e-09], device='cuda:0')
Coefficient gradients: tensor([8.4051e-09, 8.4051e-09, 8.4051e-09], device='cuda:0')
Coefficient gradients: tensor([-6.4299e-09, -6.4299e-09, -6.4299e-09], device='cuda:0')
Coefficient gradients: tensor([-4.6668e-09, -4.6668e-09, -4.6668e-09], device='cuda:0')
Coefficient gradients: tensor([-2.9756e-09, -2.9756e-09, -2.9756e-09], device='cuda:0')
Epoch 9, Loss: 1.8291, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.0783e-09, -8.0783e-09, -8.0783e-09], device='cuda:0')
Coefficient gradients: tensor([-5.8837e-09, -5.8837e-09, -5.8837e-09], device='cuda:0')
Coefficient gradients: tensor([8.3856e-10, 8.3856e-10, 8.3856e-10], device='cuda:0')
Coefficient gradients: tensor([-6.4917e-09, -6.4917e-09, -6.4917e-09], device='cuda:0')
Coefficient gradients: tensor([-5.5381e-09, -5.5381e-09, -5.5381e-09], device='cuda:0')
Coefficient gradients: tensor([-2.1375e-09, -2.1375e-09, -2.1375e-09], device='cuda:0')
Coefficient gradients: tensor([-9.3068e-09, -9.3068e-09, -9.3068e-09], device='cuda:0')
Coefficient gradients: tensor([-6.2083e-10, -6.2083e-10, -6.2083e-10], device='cuda:0')
Epoch 10, Loss: 1.8639, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.0002e-08, -1.0002e-08, -1.0002e-08], device='cuda:0')
Coefficient gradients: tensor([-3.4675e-10, -3.4675e-10, -3.4675e-10], device='cuda:0')
Coefficient gradients: tensor([-8.2408e-09, -8.2408e-09, -8.2408e-09], device='cuda:0')
Coefficient gradients: tensor([-1.4125e-08, -1.4125e-08, -1.4125e-08], device='cuda:0')
Coefficient gradients: tensor([-4.7543e-09, -4.7543e-09, -4.7543e-09], device='cuda:0')
Coefficient gradients: tensor([-3.6862e-09, -3.6862e-09, -3.6862e-09], device='cuda:0')
Coefficient gradients: tensor([-1.9793e-08, -1.9793e-08, -1.9793e-08], device='cuda:0')
Coefficient gradients: tensor([-7.1406e-09, -7.1406e-09, -7.1406e-09], device='cuda:0')
Epoch 11, Loss: 1.8616, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-2.4561e-09, -2.4561e-09, -2.4561e-09], device='cuda:0')
Coefficient gradients: tensor([2.5979e-10, 2.5979e-10, 2.5979e-10], device='cuda:0')
Coefficient gradients: tensor([-8.3649e-09, -8.3649e-09, -8.3649e-09], device='cuda:0')
Coefficient gradients: tensor([-4.7258e-11, -4.7258e-11, -4.7258e-11], device='cuda:0')
Coefficient gradients: tensor([-9.9289e-09, -9.9289e-09, -9.9289e-09], device='cuda:0')
Coefficient gradients: tensor([-8.0729e-09, -8.0729e-09, -8.0729e-09], device='cuda:0')
Coefficient gradients: tensor([-8.4002e-09, -8.4002e-09, -8.4002e-09], device='cuda:0')
Coefficient gradients: tensor([7.0084e-10, 7.0084e-10, 7.0084e-10], device='cuda:0')
Epoch 12, Loss: 1.8431, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([1.6624e-09, 1.6624e-09, 1.6624e-09], device='cuda:0')
Coefficient gradients: tensor([-8.4987e-09, -8.4987e-09, -8.4987e-09], device='cuda:0')
Coefficient gradients: tensor([-8.6364e-09, -8.6364e-09, -8.6364e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1154e-09, -1.1154e-09, -1.1154e-09], device='cuda:0')
Coefficient gradients: tensor([-9.3001e-09, -9.3001e-09, -9.3001e-09], device='cuda:0')
Coefficient gradients: tensor([-8.6593e-09, -8.6593e-09, -8.6593e-09], device='cuda:0')
Coefficient gradients: tensor([4.4655e-09, 4.4655e-09, 4.4655e-09], device='cuda:0')
Coefficient gradients: tensor([-6.0890e-10, -6.0890e-10, -6.0890e-10], device='cuda:0')
Epoch 13, Loss: 1.8846, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.1413e-09, -8.1413e-09, -8.1413e-09], device='cuda:0')
Coefficient gradients: tensor([1.9464e-09, 1.9464e-09, 1.9464e-09], device='cuda:0')
Coefficient gradients: tensor([-1.4513e-09, -1.4513e-09, -1.4513e-09], device='cuda:0')
Coefficient gradients: tensor([-2.2859e-09, -2.2859e-09, -2.2859e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1241e-08, -1.1241e-08, -1.1241e-08], device='cuda:0')
Coefficient gradients: tensor([-1.5172e-08, -1.5172e-08, -1.5172e-08], device='cuda:0')
Coefficient gradients: tensor([-1.2206e-09, -1.2206e-09, -1.2206e-09], device='cuda:0')
Coefficient gradients: tensor([-7.4549e-09, -7.4549e-09, -7.4549e-09], device='cuda:0')
Epoch 14, Loss: 1.8375, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-7.3753e-09, -7.3753e-09, -7.3753e-09], device='cuda:0')
Coefficient gradients: tensor([-9.3522e-09, -9.3522e-09, -9.3522e-09], device='cuda:0')
Coefficient gradients: tensor([-2.1916e-09, -2.1916e-09, -2.1916e-09], device='cuda:0')
Coefficient gradients: tensor([-1.6844e-08, -1.6844e-08, -1.6844e-08], device='cuda:0')
Coefficient gradients: tensor([8.0606e-09, 8.0606e-09, 8.0606e-09], device='cuda:0')
Coefficient gradients: tensor([-8.7315e-09, -8.7315e-09, -8.7315e-09], device='cuda:0')
Coefficient gradients: tensor([7.2946e-09, 7.2946e-09, 7.2946e-09], device='cuda:0')
Coefficient gradients: tensor([6.3093e-09, 6.3093e-09, 6.3093e-09], device='cuda:0')
Epoch 15, Loss: 1.9291, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.1337e-08, -1.1337e-08, -1.1337e-08], device='cuda:0')
Coefficient gradients: tensor([2.8911e-09, 2.8911e-09, 2.8911e-09], device='cuda:0')
Coefficient gradients: tensor([-9.7580e-10, -9.7580e-10, -9.7580e-10], device='cuda:0')
Coefficient gradients: tensor([-7.0153e-09, -7.0153e-09, -7.0153e-09], device='cuda:0')
Coefficient gradients: tensor([-4.6409e-09, -4.6409e-09, -4.6409e-09], device='cuda:0')
Coefficient gradients: tensor([-3.0085e-08, -3.0085e-08, -3.0085e-08], device='cuda:0')
Coefficient gradients: tensor([-1.7764e-09, -1.7764e-09, -1.7764e-09], device='cuda:0')
Coefficient gradients: tensor([-1.6872e-08, -1.6872e-08, -1.6872e-08], device='cuda:0')
Epoch 16, Loss: 1.9367, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.7978e-08, -1.7978e-08, -1.7978e-08], device='cuda:0')
Coefficient gradients: tensor([-3.7628e-09, -3.7628e-09, -3.7628e-09], device='cuda:0')
Coefficient gradients: tensor([-8.8559e-09, -8.8559e-09, -8.8559e-09], device='cuda:0')
Coefficient gradients: tensor([-1.2242e-08, -1.2242e-08, -1.2242e-08], device='cuda:0')
Coefficient gradients: tensor([-8.7658e-09, -8.7658e-09, -8.7658e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8822e-09, -1.8822e-09, -1.8822e-09], device='cuda:0')
Coefficient gradients: tensor([-7.6169e-09, -7.6169e-09, -7.6169e-09], device='cuda:0')
Coefficient gradients: tensor([-6.6408e-09, -6.6408e-09, -6.6408e-09], device='cuda:0')
Epoch 17, Loss: 1.8543, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-2.0493e-09, -2.0493e-09, -2.0493e-09], device='cuda:0')
Coefficient gradients: tensor([3.1936e-09, 3.1936e-09, 3.1936e-09], device='cuda:0')
Coefficient gradients: tensor([-3.0498e-08, -3.0498e-08, -3.0498e-08], device='cuda:0')
Coefficient gradients: tensor([-8.3937e-09, -8.3937e-09, -8.3937e-09], device='cuda:0')
Coefficient gradients: tensor([-4.1003e-09, -4.1003e-09, -4.1003e-09], device='cuda:0')
Coefficient gradients: tensor([-3.0118e-08, -3.0118e-08, -3.0118e-08], device='cuda:0')
Coefficient gradients: tensor([-1.8496e-08, -1.8496e-08, -1.8496e-08], device='cuda:0')
Coefficient gradients: tensor([-1.7997e-08, -1.7997e-08, -1.7997e-08], device='cuda:0')
Epoch 18, Loss: 1.8807, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.7394e-09, -3.7394e-09, -3.7394e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1956e-08, -1.1956e-08, -1.1956e-08], device='cuda:0')
Coefficient gradients: tensor([8.8045e-09, 8.8045e-09, 8.8045e-09], device='cuda:0')
Coefficient gradients: tensor([-8.7149e-09, -8.7149e-09, -8.7149e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8370e-09, -1.8370e-09, -1.8370e-09], device='cuda:0')
Coefficient gradients: tensor([-4.1946e-10, -4.1946e-10, -4.1946e-10], device='cuda:0')
Coefficient gradients: tensor([-4.1336e-09, -4.1336e-09, -4.1336e-09], device='cuda:0')
Coefficient gradients: tensor([-4.6275e-09, -4.6275e-09, -4.6275e-09], device='cuda:0')
Epoch 19, Loss: 1.8445, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.5207e-10, -8.5207e-10, -8.5207e-10], device='cuda:0')
Coefficient gradients: tensor([-6.9567e-09, -6.9567e-09, -6.9567e-09], device='cuda:0')
Coefficient gradients: tensor([-5.2766e-09, -5.2766e-09, -5.2766e-09], device='cuda:0')
Coefficient gradients: tensor([-1.9327e-08, -1.9327e-08, -1.9327e-08], device='cuda:0')
Coefficient gradients: tensor([-9.8047e-09, -9.8047e-09, -9.8047e-09], device='cuda:0')
Coefficient gradients: tensor([3.8054e-09, 3.8054e-09, 3.8054e-09], device='cuda:0')
Coefficient gradients: tensor([3.1977e-10, 3.1977e-10, 3.1977e-10], device='cuda:0')
Coefficient gradients: tensor([-3.6568e-08, -3.6568e-08, -3.6568e-08], device='cuda:0')
Epoch 20, Loss: 1.9210, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Best coefficient accuracy: 36.32%
Final best coefficients: [0.33333334 0.33333334 0.33333334]

Merged model with TIES - Test Loss: 1.6269, Test Accuracy: 38.34%

--- Run 3/3 ---

Running LoRA with TIES experiment
Test domain: cartoon
Train domains: ['photo', 'art_painting', 'sketch']
Baseline Epoch 1/10, Train Loss: 1.9256, Train Accuracy: 20.94%
Val Loss: 1.5442, Val Accuracy: 42.18%
Baseline Epoch 2/10, Train Loss: 1.0251, Train Accuracy: 67.09%
Val Loss: 1.0646, Val Accuracy: 63.60%
Baseline Epoch 3/10, Train Loss: 0.4749, Train Accuracy: 87.61%
Val Loss: 0.7574, Val Accuracy: 75.02%
Baseline Epoch 4/10, Train Loss: 0.1716, Train Accuracy: 97.01%
Val Loss: 0.6073, Val Accuracy: 80.43%
Baseline Epoch 5/10, Train Loss: 0.0472, Train Accuracy: 100.00%
Val Loss: 0.5425, Val Accuracy: 82.09%
Baseline Epoch 6/10, Train Loss: 0.0151, Train Accuracy: 100.00%
Val Loss: 0.5305, Val Accuracy: 82.27%
Baseline Epoch 7/10, Train Loss: 0.0076, Train Accuracy: 100.00%
Val Loss: 0.5270, Val Accuracy: 82.09%
Baseline Epoch 8/10, Train Loss: 0.0051, Train Accuracy: 100.00%
Val Loss: 0.5133, Val Accuracy: 82.51%
Baseline Epoch 9/10, Train Loss: 0.0036, Train Accuracy: 100.00%
Val Loss: 0.5060, Val Accuracy: 82.94%
Baseline Epoch 10/10, Train Loss: 0.0029, Train Accuracy: 100.00%
Val Loss: 0.5049, Val Accuracy: 82.61%
Baseline Model - Final Test Accuracy: 82.61%

Training LoRA adapter for domain: photo

Training LoRA adapter for domain: photo
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.6476, Train Accuracy: 39.52%
Val Loss: 0.9074, Val Accuracy: 77.25%
Epoch 2/10, Train Loss: 0.5210, Train Accuracy: 90.27%
Val Loss: 0.1638, Val Accuracy: 97.90%
Epoch 3/10, Train Loss: 0.0701, Train Accuracy: 98.73%
Val Loss: 0.0414, Val Accuracy: 98.80%
Epoch 4/10, Train Loss: 0.0161, Train Accuracy: 100.00%
Val Loss: 0.0227, Val Accuracy: 99.40%
Epoch 5/10, Train Loss: 0.0060, Train Accuracy: 100.00%
Val Loss: 0.0166, Val Accuracy: 99.40%
Epoch 6/10, Train Loss: 0.0032, Train Accuracy: 100.00%
Val Loss: 0.0175, Val Accuracy: 99.40%
Epoch 7/10, Train Loss: 0.0022, Train Accuracy: 100.00%
Val Loss: 0.0164, Val Accuracy: 99.40%
Epoch 8/10, Train Loss: 0.0016, Train Accuracy: 100.00%
Val Loss: 0.0142, Val Accuracy: 99.40%
Epoch 9/10, Train Loss: 0.0012, Train Accuracy: 100.00%
Val Loss: 0.0128, Val Accuracy: 99.40%
Epoch 10/10, Train Loss: 0.0010, Train Accuracy: 100.00%
Val Loss: 0.0123, Val Accuracy: 99.40%
Best validation accuracy for photo: 99.40%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
photo adapter trained. Validation Accuracy: 99.40%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: art_painting

Training LoRA adapter for domain: art_painting
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.7574, Train Accuracy: 33.76%
Val Loss: 1.1483, Val Accuracy: 63.17%
Epoch 2/10, Train Loss: 0.6242, Train Accuracy: 83.64%
Val Loss: 0.2981, Val Accuracy: 93.17%
Epoch 3/10, Train Loss: 0.1660, Train Accuracy: 95.97%
Val Loss: 0.1649, Val Accuracy: 95.85%
Epoch 4/10, Train Loss: 0.0610, Train Accuracy: 98.96%
Val Loss: 0.1503, Val Accuracy: 95.12%
Epoch 5/10, Train Loss: 0.0334, Train Accuracy: 99.51%
Val Loss: 0.1026, Val Accuracy: 96.59%
Epoch 6/10, Train Loss: 0.0149, Train Accuracy: 99.82%
Val Loss: 0.1141, Val Accuracy: 96.83%
Epoch 7/10, Train Loss: 0.0075, Train Accuracy: 99.94%
Val Loss: 0.0976, Val Accuracy: 97.32%
Epoch 8/10, Train Loss: 0.0051, Train Accuracy: 100.00%
Val Loss: 0.0910, Val Accuracy: 97.07%
Epoch 9/10, Train Loss: 0.0034, Train Accuracy: 100.00%
Val Loss: 0.0859, Val Accuracy: 97.80%
Epoch 10/10, Train Loss: 0.0026, Train Accuracy: 100.00%
Val Loss: 0.0895, Val Accuracy: 97.07%
Best validation accuracy for art_painting: 97.80%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
art_painting adapter trained. Validation Accuracy: 97.80%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Training LoRA adapter for domain: sketch

Training LoRA adapter for domain: sketch
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Epoch 1/10, Train Loss: 1.3250, Train Accuracy: 48.86%
Val Loss: 0.9089, Val Accuracy: 62.96%
Epoch 2/10, Train Loss: 0.7328, Train Accuracy: 70.94%
Val Loss: 0.8132, Val Accuracy: 66.79%
Epoch 3/10, Train Loss: 0.5619, Train Accuracy: 78.24%
Val Loss: 0.6028, Val Accuracy: 75.18%
Epoch 4/10, Train Loss: 0.4209, Train Accuracy: 84.17%
Val Loss: 0.4907, Val Accuracy: 80.84%
Epoch 5/10, Train Loss: 0.3282, Train Accuracy: 87.91%
Val Loss: 0.4358, Val Accuracy: 82.85%
Epoch 6/10, Train Loss: 0.2627, Train Accuracy: 90.51%
Val Loss: 0.4037, Val Accuracy: 83.94%
Epoch 7/10, Train Loss: 0.2162, Train Accuracy: 92.15%
Val Loss: 0.4272, Val Accuracy: 83.58%
Epoch 8/10, Train Loss: 0.1697, Train Accuracy: 94.71%
Val Loss: 0.4137, Val Accuracy: 84.31%
Epoch 9/10, Train Loss: 0.1170, Train Accuracy: 97.08%
Val Loss: 0.3875, Val Accuracy: 85.58%
Epoch 10/10, Train Loss: 0.0978, Train Accuracy: 97.22%
Val Loss: 0.3625, Val Accuracy: 87.96%
Best validation accuracy for sketch: 87.96%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])
sketch adapter trained. Validation Accuracy: 87.96%
LoRA state keys: dict_keys(['base_model.model.blocks.0.attn.qkv.lora_A.weight', 'base_model.model.blocks.0.attn.qkv.lora_B.weight', 'base_model.model.blocks.1.attn.qkv.lora_A.weight', 'base_model.model.blocks.1.attn.qkv.lora_B.weight', 'base_model.model.blocks.2.attn.qkv.lora_A.weight', 'base_model.model.blocks.2.attn.qkv.lora_B.weight', 'base_model.model.blocks.3.attn.qkv.lora_A.weight', 'base_model.model.blocks.3.attn.qkv.lora_B.weight', 'base_model.model.blocks.4.attn.qkv.lora_A.weight', 'base_model.model.blocks.4.attn.qkv.lora_B.weight', 'base_model.model.blocks.5.attn.qkv.lora_A.weight', 'base_model.model.blocks.5.attn.qkv.lora_B.weight', 'base_model.model.blocks.6.attn.qkv.lora_A.weight', 'base_model.model.blocks.6.attn.qkv.lora_B.weight', 'base_model.model.blocks.7.attn.qkv.lora_A.weight', 'base_model.model.blocks.7.attn.qkv.lora_B.weight', 'base_model.model.blocks.8.attn.qkv.lora_A.weight', 'base_model.model.blocks.8.attn.qkv.lora_B.weight', 'base_model.model.blocks.9.attn.qkv.lora_A.weight', 'base_model.model.blocks.9.attn.qkv.lora_B.weight', 'base_model.model.blocks.10.attn.qkv.lora_A.weight', 'base_model.model.blocks.10.attn.qkv.lora_B.weight', 'base_model.model.blocks.11.attn.qkv.lora_A.weight', 'base_model.model.blocks.11.attn.qkv.lora_B.weight'])

Number of trained LoRA adapters: 3

Evaluating individual LoRA adapters on the test domain:
Created LoRA model: <class 'peft.peft_model.PeftModel'>
photo adapter - Test Loss: 3.0517, Test Accuracy: 32.70%
Created LoRA model: <class 'peft.peft_model.PeftModel'>
art_painting adapter - Test Loss: 1.0611, Test Accuracy: 69.81%
Created LoRA model: <class 'peft.peft_model.PeftModel'>
sketch adapter - Test Loss: 1.8048, Test Accuracy: 39.48%

Training coefficients for adapter merging
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Created LoRA model: <class 'peft.peft_model.PeftModel'>
Coefficient gradients: tensor([-6.7274e-09, -6.7274e-09, -6.7274e-09], device='cuda:0')
Coefficient gradients: tensor([-8.2768e-09, -8.2768e-09, -8.2768e-09], device='cuda:0')
Coefficient gradients: tensor([-3.3812e-08, -3.3812e-08, -3.3812e-08], device='cuda:0')
Coefficient gradients: tensor([-7.1500e-10, -7.1500e-10, -7.1500e-10], device='cuda:0')
Coefficient gradients: tensor([-7.7158e-09, -7.7158e-09, -7.7158e-09], device='cuda:0')
Coefficient gradients: tensor([-8.7652e-09, -8.7652e-09, -8.7652e-09], device='cuda:0')
Coefficient gradients: tensor([3.1744e-09, 3.1744e-09, 3.1744e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8785e-08, -1.8785e-08, -1.8785e-08], device='cuda:0')
Epoch 1, Loss: 1.8831, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-2.6933e-09, -2.6933e-09, -2.6933e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1854e-08, -1.1854e-08, -1.1854e-08], device='cuda:0')
Coefficient gradients: tensor([-7.2970e-09, -7.2970e-09, -7.2970e-09], device='cuda:0')
Coefficient gradients: tensor([-8.4736e-09, -8.4736e-09, -8.4736e-09], device='cuda:0')
Coefficient gradients: tensor([-4.2643e-09, -4.2643e-09, -4.2643e-09], device='cuda:0')
Coefficient gradients: tensor([-9.2093e-09, -9.2093e-09, -9.2093e-09], device='cuda:0')
Coefficient gradients: tensor([-7.1268e-09, -7.1268e-09, -7.1268e-09], device='cuda:0')
Coefficient gradients: tensor([-7.2569e-09, -7.2569e-09, -7.2569e-09], device='cuda:0')
Epoch 2, Loss: 1.8703, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-6.1742e-09, -6.1742e-09, -6.1742e-09], device='cuda:0')
Coefficient gradients: tensor([-6.4773e-09, -6.4773e-09, -6.4773e-09], device='cuda:0')
Coefficient gradients: tensor([-1.0057e-08, -1.0057e-08, -1.0057e-08], device='cuda:0')
Coefficient gradients: tensor([-8.4700e-10, -8.4700e-10, -8.4700e-10], device='cuda:0')
Coefficient gradients: tensor([-8.1387e-09, -8.1387e-09, -8.1387e-09], device='cuda:0')
Coefficient gradients: tensor([8.9043e-09, 8.9043e-09, 8.9043e-09], device='cuda:0')
Coefficient gradients: tensor([-1.7413e-08, -1.7413e-08, -1.7413e-08], device='cuda:0')
Coefficient gradients: tensor([1.7793e-10, 1.7793e-10, 1.7793e-10], device='cuda:0')
Epoch 3, Loss: 1.8766, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-7.1666e-09, -7.1666e-09, -7.1666e-09], device='cuda:0')
Coefficient gradients: tensor([-8.4084e-09, -8.4084e-09, -8.4084e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1061e-08, -1.1061e-08, -1.1061e-08], device='cuda:0')
Coefficient gradients: tensor([1.3017e-09, 1.3017e-09, 1.3017e-09], device='cuda:0')
Coefficient gradients: tensor([-4.5175e-09, -4.5175e-09, -4.5175e-09], device='cuda:0')
Coefficient gradients: tensor([-9.3774e-09, -9.3774e-09, -9.3774e-09], device='cuda:0')
Coefficient gradients: tensor([-1.0893e-09, -1.0893e-09, -1.0893e-09], device='cuda:0')
Coefficient gradients: tensor([-9.3876e-09, -9.3876e-09, -9.3876e-09], device='cuda:0')
Epoch 4, Loss: 1.8794, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([8.5132e-09, 8.5132e-09, 8.5132e-09], device='cuda:0')
Coefficient gradients: tensor([1.8851e-09, 1.8851e-09, 1.8851e-09], device='cuda:0')
Coefficient gradients: tensor([-5.2152e-09, -5.2152e-09, -5.2152e-09], device='cuda:0')
Coefficient gradients: tensor([-6.9570e-09, -6.9570e-09, -6.9570e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8082e-08, -1.8082e-08, -1.8082e-08], device='cuda:0')
Coefficient gradients: tensor([-7.2613e-09, -7.2613e-09, -7.2613e-09], device='cuda:0')
Coefficient gradients: tensor([1.9457e-09, 1.9457e-09, 1.9457e-09], device='cuda:0')
Coefficient gradients: tensor([-1.0176e-08, -1.0176e-08, -1.0176e-08], device='cuda:0')
Epoch 5, Loss: 1.8751, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.8655e-09, -1.8655e-09, -1.8655e-09], device='cuda:0')
Coefficient gradients: tensor([7.4319e-10, 7.4319e-10, 7.4319e-10], device='cuda:0')
Coefficient gradients: tensor([-6.3913e-09, -6.3913e-09, -6.3913e-09], device='cuda:0')
Coefficient gradients: tensor([-1.5499e-08, -1.5499e-08, -1.5499e-08], device='cuda:0')
Coefficient gradients: tensor([-8.0322e-09, -8.0322e-09, -8.0322e-09], device='cuda:0')
Coefficient gradients: tensor([-3.2539e-09, -3.2539e-09, -3.2539e-09], device='cuda:0')
Coefficient gradients: tensor([-3.0386e-08, -3.0386e-08, -3.0386e-08], device='cuda:0')
Coefficient gradients: tensor([-3.0757e-08, -3.0757e-08, -3.0757e-08], device='cuda:0')
Epoch 6, Loss: 1.9123, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-7.0896e-09, -7.0896e-09, -7.0896e-09], device='cuda:0')
Coefficient gradients: tensor([-1.4849e-09, -1.4849e-09, -1.4849e-09], device='cuda:0')
Coefficient gradients: tensor([-9.2139e-09, -9.2139e-09, -9.2139e-09], device='cuda:0')
Coefficient gradients: tensor([-8.7424e-09, -8.7424e-09, -8.7424e-09], device='cuda:0')
Coefficient gradients: tensor([-1.9374e-10, -1.9374e-10, -1.9374e-10], device='cuda:0')
Coefficient gradients: tensor([-7.2387e-09, -7.2387e-09, -7.2387e-09], device='cuda:0')
Coefficient gradients: tensor([-9.5248e-09, -9.5248e-09, -9.5248e-09], device='cuda:0')
Coefficient gradients: tensor([-1.5140e-08, -1.5140e-08, -1.5140e-08], device='cuda:0')
Epoch 7, Loss: 1.9178, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.3836e-10, -8.3836e-10, -8.3836e-10], device='cuda:0')
Coefficient gradients: tensor([-7.9136e-09, -7.9136e-09, -7.9136e-09], device='cuda:0')
Coefficient gradients: tensor([-4.8926e-09, -4.8926e-09, -4.8926e-09], device='cuda:0')
Coefficient gradients: tensor([-7.8015e-09, -7.8015e-09, -7.8015e-09], device='cuda:0')
Coefficient gradients: tensor([-9.6783e-09, -9.6783e-09, -9.6783e-09], device='cuda:0')
Coefficient gradients: tensor([-1.9630e-09, -1.9630e-09, -1.9630e-09], device='cuda:0')
Coefficient gradients: tensor([-5.2368e-10, -5.2368e-10, -5.2368e-10], device='cuda:0')
Coefficient gradients: tensor([-7.0102e-09, -7.0102e-09, -7.0102e-09], device='cuda:0')
Epoch 8, Loss: 1.8638, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-7.7669e-11, -7.7669e-11, -7.7669e-11], device='cuda:0')
Coefficient gradients: tensor([1.6996e-09, 1.6996e-09, 1.6996e-09], device='cuda:0')
Coefficient gradients: tensor([-8.1727e-09, -8.1727e-09, -8.1727e-09], device='cuda:0')
Coefficient gradients: tensor([-8.2370e-09, -8.2370e-09, -8.2370e-09], device='cuda:0')
Coefficient gradients: tensor([-1.5268e-09, -1.5268e-09, -1.5268e-09], device='cuda:0')
Coefficient gradients: tensor([-6.4426e-09, -6.4426e-09, -6.4426e-09], device='cuda:0')
Coefficient gradients: tensor([-4.6622e-09, -4.6622e-09, -4.6622e-09], device='cuda:0')
Coefficient gradients: tensor([-2.9814e-09, -2.9814e-09, -2.9814e-09], device='cuda:0')
Epoch 9, Loss: 1.8286, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.0962e-09, -8.0962e-09, -8.0962e-09], device='cuda:0')
Coefficient gradients: tensor([4.0807e-09, 4.0807e-09, 4.0807e-09], device='cuda:0')
Coefficient gradients: tensor([-9.0802e-09, -9.0802e-09, -9.0802e-09], device='cuda:0')
Coefficient gradients: tensor([-1.6425e-08, -1.6425e-08, -1.6425e-08], device='cuda:0')
Coefficient gradients: tensor([-5.6773e-10, -5.6773e-10, -5.6773e-10], device='cuda:0')
Coefficient gradients: tensor([-3.1934e-08, -3.1934e-08, -3.1934e-08], device='cuda:0')
Coefficient gradients: tensor([-9.2866e-09, -9.2866e-09, -9.2866e-09], device='cuda:0')
Coefficient gradients: tensor([-5.5881e-09, -5.5881e-09, -5.5881e-09], device='cuda:0')
Epoch 10, Loss: 1.8630, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-9.9826e-09, -9.9826e-09, -9.9826e-09], device='cuda:0')
Coefficient gradients: tensor([4.6344e-09, 4.6344e-09, 4.6344e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8173e-08, -1.8173e-08, -1.8173e-08], device='cuda:0')
Coefficient gradients: tensor([-4.1907e-09, -4.1907e-09, -4.1907e-09], device='cuda:0')
Coefficient gradients: tensor([-4.7495e-09, -4.7495e-09, -4.7495e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1901e-09, -1.1901e-09, -1.1901e-09], device='cuda:0')
Coefficient gradients: tensor([7.2706e-11, 7.2706e-11, 7.2706e-11], device='cuda:0')
Coefficient gradients: tensor([-7.1134e-09, -7.1134e-09, -7.1134e-09], device='cuda:0')
Epoch 11, Loss: 1.8607, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-7.4026e-09, -7.4026e-09, -7.4026e-09], device='cuda:0')
Coefficient gradients: tensor([-9.6530e-09, -9.6530e-09, -9.6530e-09], device='cuda:0')
Coefficient gradients: tensor([1.5850e-09, 1.5850e-09, 1.5850e-09], device='cuda:0')
Coefficient gradients: tensor([4.9267e-09, 4.9267e-09, 4.9267e-09], device='cuda:0')
Coefficient gradients: tensor([-9.9439e-09, -9.9439e-09, -9.9439e-09], device='cuda:0')
Coefficient gradients: tensor([-8.0580e-09, -8.0580e-09, -8.0580e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8348e-08, -1.8348e-08, -1.8348e-08], device='cuda:0')
Coefficient gradients: tensor([-4.2401e-09, -4.2401e-09, -4.2401e-09], device='cuda:0')
Epoch 12, Loss: 1.8423, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.2683e-09, -8.2683e-09, -8.2683e-09], device='cuda:0')
Coefficient gradients: tensor([-8.5267e-09, -8.5267e-09, -8.5267e-09], device='cuda:0')
Coefficient gradients: tensor([-8.6273e-09, -8.6273e-09, -8.6273e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1170e-09, -1.1170e-09, -1.1170e-09], device='cuda:0')
Coefficient gradients: tensor([6.3378e-10, 6.3378e-10, 6.3378e-10], device='cuda:0')
Coefficient gradients: tensor([1.2936e-09, 1.2936e-09, 1.2936e-09], device='cuda:0')
Coefficient gradients: tensor([-4.5546e-10, -4.5546e-10, -4.5546e-10], device='cuda:0')
Coefficient gradients: tensor([9.3604e-09, 9.3604e-09, 9.3604e-09], device='cuda:0')
Epoch 13, Loss: 1.8835, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.8080e-08, -1.8080e-08, -1.8080e-08], device='cuda:0')
Coefficient gradients: tensor([1.9513e-09, 1.9513e-09, 1.9513e-09], device='cuda:0')
Coefficient gradients: tensor([-1.4611e-09, -1.4611e-09, -1.4611e-09], device='cuda:0')
Coefficient gradients: tensor([7.6418e-09, 7.6418e-09, 7.6418e-09], device='cuda:0')
Coefficient gradients: tensor([-3.1097e-08, -3.1097e-08, -3.1097e-08], device='cuda:0')
Coefficient gradients: tensor([-2.6152e-10, -2.6152e-10, -2.6152e-10], device='cuda:0')
Coefficient gradients: tensor([3.7922e-09, 3.7922e-09, 3.7922e-09], device='cuda:0')
Coefficient gradients: tensor([-2.4666e-09, -2.4666e-09, -2.4666e-09], device='cuda:0')
Epoch 14, Loss: 1.8366, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-7.3858e-09, -7.3858e-09, -7.3858e-09], device='cuda:0')
Coefficient gradients: tensor([-9.3342e-09, -9.3342e-09, -9.3342e-09], device='cuda:0')
Coefficient gradients: tensor([3.0178e-10, 3.0178e-10, 3.0178e-10], device='cuda:0')
Coefficient gradients: tensor([-6.8908e-09, -6.8908e-09, -6.8908e-09], device='cuda:0')
Coefficient gradients: tensor([8.0629e-09, 8.0629e-09, 8.0629e-09], device='cuda:0')
Coefficient gradients: tensor([-3.7569e-09, -3.7569e-09, -3.7569e-09], device='cuda:0')
Coefficient gradients: tensor([-3.2434e-08, -3.2434e-08, -3.2434e-08], device='cuda:0')
Coefficient gradients: tensor([-3.6109e-09, -3.6109e-09, -3.6109e-09], device='cuda:0')
Epoch 15, Loss: 1.9282, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-1.1341e-08, -1.1341e-08, -1.1341e-08], device='cuda:0')
Coefficient gradients: tensor([-7.0251e-09, -7.0251e-09, -7.0251e-09], device='cuda:0')
Coefficient gradients: tensor([8.9675e-09, 8.9675e-09, 8.9675e-09], device='cuda:0')
Coefficient gradients: tensor([-7.0155e-09, -7.0155e-09, -7.0155e-09], device='cuda:0')
Coefficient gradients: tensor([3.3333e-10, 3.3333e-10, 3.3333e-10], device='cuda:0')
Coefficient gradients: tensor([-1.0202e-08, -1.0202e-08, -1.0202e-08], device='cuda:0')
Coefficient gradients: tensor([-5.1819e-10, -5.1819e-10, -5.1819e-10], device='cuda:0')
Coefficient gradients: tensor([-1.6879e-08, -1.6879e-08, -1.6879e-08], device='cuda:0')
Epoch 16, Loss: 1.9360, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-8.0346e-09, -8.0346e-09, -8.0346e-09], device='cuda:0')
Coefficient gradients: tensor([1.1887e-09, 1.1887e-09, 1.1887e-09], device='cuda:0')
Coefficient gradients: tensor([-8.8362e-09, -8.8362e-09, -8.8362e-09], device='cuda:0')
Coefficient gradients: tensor([-2.3086e-09, -2.3086e-09, -2.3086e-09], device='cuda:0')
Coefficient gradients: tensor([-8.7644e-09, -8.7644e-09, -8.7644e-09], device='cuda:0')
Coefficient gradients: tensor([-1.8678e-09, -1.8678e-09, -1.8678e-09], device='cuda:0')
Coefficient gradients: tensor([-7.6017e-09, -7.6017e-09, -7.6017e-09], device='cuda:0')
Coefficient gradients: tensor([3.3401e-09, 3.3401e-09, 3.3401e-09], device='cuda:0')
Epoch 17, Loss: 1.8531, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-2.0384e-09, -2.0384e-09, -2.0384e-09], device='cuda:0')
Coefficient gradients: tensor([-1.7558e-09, -1.7558e-09, -1.7558e-09], device='cuda:0')
Coefficient gradients: tensor([-6.9046e-10, -6.9046e-10, -6.9046e-10], device='cuda:0')
Coefficient gradients: tensor([-1.8326e-08, -1.8326e-08, -1.8326e-08], device='cuda:0')
Coefficient gradients: tensor([8.6895e-10, 8.6895e-10, 8.6895e-10], device='cuda:0')
Coefficient gradients: tensor([-3.0101e-08, -3.0101e-08, -3.0101e-08], device='cuda:0')
Coefficient gradients: tensor([-8.5549e-09, -8.5549e-09, -8.5549e-09], device='cuda:0')
Coefficient gradients: tensor([-8.0701e-09, -8.0701e-09, -8.0701e-09], device='cuda:0')
Epoch 18, Loss: 1.8801, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-3.7429e-09, -3.7429e-09, -3.7429e-09], device='cuda:0')
Coefficient gradients: tensor([-3.1841e-08, -3.1841e-08, -3.1841e-08], device='cuda:0')
Coefficient gradients: tensor([8.8324e-09, 8.8324e-09, 8.8324e-09], device='cuda:0')
Coefficient gradients: tensor([-8.6883e-09, -8.6883e-09, -8.6883e-09], device='cuda:0')
Coefficient gradients: tensor([3.1503e-09, 3.1503e-09, 3.1503e-09], device='cuda:0')
Coefficient gradients: tensor([-1.0365e-08, -1.0365e-08, -1.0365e-08], device='cuda:0')
Coefficient gradients: tensor([-4.1289e-09, -4.1289e-09, -4.1289e-09], device='cuda:0')
Coefficient gradients: tensor([-4.5956e-09, -4.5956e-09, -4.5956e-09], device='cuda:0')
Epoch 19, Loss: 1.8436, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Coefficient gradients: tensor([-5.8145e-09, -5.8145e-09, -5.8145e-09], device='cuda:0')
Coefficient gradients: tensor([-6.9294e-09, -6.9294e-09, -6.9294e-09], device='cuda:0')
Coefficient gradients: tensor([-5.2559e-09, -5.2559e-09, -5.2559e-09], device='cuda:0')
Coefficient gradients: tensor([-1.9330e-08, -1.9330e-08, -1.9330e-08], device='cuda:0')
Coefficient gradients: tensor([-9.8067e-09, -9.8067e-09, -9.8067e-09], device='cuda:0')
Coefficient gradients: tensor([-1.1502e-09, -1.1502e-09, -1.1502e-09], device='cuda:0')
Coefficient gradients: tensor([-9.6176e-09, -9.6176e-09, -9.6176e-09], device='cuda:0')
Coefficient gradients: tensor([-1.6692e-08, -1.6692e-08, -1.6692e-08], device='cuda:0')
Epoch 20, Loss: 1.9204, Accuracy: 36.32%
Coefficients: [0.33333334 0.33333334 0.33333334]
Best coefficient accuracy: 36.32%
Final best coefficients: [0.33333334 0.33333334 0.33333334]

Merged model with TIES - Test Loss: 1.6266, Test Accuracy: 38.29%

Summary of All Runs:
Baseline Model Accuracy: 82.61%  0.00%
Merged Model Accuracy: 38.25%  0.10%
Average Coefficients:
  photo: 0.3333  0.0000
  art_painting: 0.3333  0.0000
  sketch: 0.3333  0.0000
