50 OfficeHome

==================================================
Running experiments for dataset: PACS
==================================================
Dataset config for PACS:
{'dataset_path': '/leonardo_scratch/fast/IscrC_FoundCL/cl/lora-CL/ratatouille/ood/datasets/PACS', 'max_samples_per_class': None, 'base_model': 'vit_base_patch16_224', 'batch_size': 32, 'num_epochs': 10, 'learning_rate': 0.001, 'lora_r': 8, 'lora_alpha': 32, 'lora_dropout': 0.1, 'coefficient_learning_rate': 0.1, 'coefficient_epochs': 10, 'seed': 42}
Type of dataset_config: <class 'dict'>
Contents of dataset_config:
{'dataset_path': '/leonardo_scratch/fast/IscrC_FoundCL/cl/lora-CL/ratatouille/ood/datasets/PACS', 'max_samples_per_class': None, 'base_model': 'vit_base_patch16_224', 'batch_size': 32, 'num_epochs': 10, 'learning_rate': 0.001, 'lora_r': 8, 'lora_alpha': 32, 'lora_dropout': 0.1, 'coefficient_learning_rate': 0.1, 'coefficient_epochs': 10, 'seed': 42}

Run 1/10
Preparing data...
Domains: ['art_painting', 'cartoon', 'photo', 'sketch']
Selected test domain: art_painting
Training domains: ['cartoon', 'photo', 'sketch']

Domain: cartoon
  Class person: 405 samples
  Class giraffe: 346 samples
  Class elephant: 457 samples
  Class house: 288 samples
  Class guitar: 135 samples
  Class dog: 389 samples
  Class horse: 324 samples
  Total samples: 2344

Domain: sketch
  Class person: 160 samples
  Class giraffe: 753 samples
  Class elephant: 740 samples
  Class house: 80 samples
  Class guitar: 608 samples
  Class dog: 772 samples
  Class horse: 816 samples
  Total samples: 3929

Domain: art_painting
  Class person: 449 samples
  Class giraffe: 285 samples
  Class elephant: 255 samples
  Class house: 295 samples
  Class guitar: 184 samples
  Class dog: 379 samples
  Class horse: 201 samples
  Total samples: 2048

Domain: photo
  Class person: 432 samples
  Class giraffe: 182 samples
  Class elephant: 202 samples
  Class house: 280 samples
  Class guitar: 186 samples
  Class dog: 189 samples
  Class horse: 199 samples
  Total samples: 1670
Test domain: art_painting
Performing naive fine-tuning on test domain
Epoch 1, Average Loss: 4.6050
Epoch 2, Average Loss: 2.9000
Epoch 3, Average Loss: 2.3984
Epoch 4, Average Loss: 2.0893
Epoch 5, Average Loss: 2.1560
Epoch 6, Average Loss: 1.9984
Epoch 7, Average Loss: 1.9801
Epoch 8, Average Loss: 1.8805
Epoch 9, Average Loss: 1.9287
Epoch 10, Average Loss: 1.8979
Accuracy: 24.1866
Training domains: ['cartoon', 'photo', 'sketch']

Training expert models...

Training model for domain: cartoon
Training model for domain: cartoon
Epoch 1, Average Loss: 0.5183
Epoch 2, Average Loss: 0.1450
Epoch 3, Average Loss: 0.1502
Epoch 4, Average Loss: 0.1449
Epoch 5, Average Loss: 0.1552
Epoch 6, Average Loss: 0.0757
Epoch 7, Average Loss: 0.0895
Epoch 8, Average Loss: 0.1033
Epoch 9, Average Loss: 0.1005
Epoch 10, Average Loss: 0.1088
Merged model device: cuda:0
Accuracy: 56.0738
Accuracy of cartoon model on test domain: 56.0738

Training model for domain: photo
Training model for domain: photo
Epoch 1, Average Loss: 0.1997
Epoch 2, Average Loss: 0.0268
Epoch 3, Average Loss: 0.0262
Epoch 4, Average Loss: 0.0202
Epoch 5, Average Loss: 0.0221
Epoch 6, Average Loss: 0.0735
Epoch 7, Average Loss: 0.1355
Epoch 8, Average Loss: 0.1060
Epoch 9, Average Loss: 0.0841
Epoch 10, Average Loss: 0.0894
Merged model device: cuda:0
Accuracy: 63.9913
Accuracy of photo model on test domain: 63.9913

Training model for domain: sketch
Training model for domain: sketch
Epoch 1, Average Loss: 0.4983
Epoch 2, Average Loss: 0.2068
Epoch 3, Average Loss: 0.1889
Epoch 4, Average Loss: 0.1859
Epoch 5, Average Loss: 0.1570
Epoch 6, Average Loss: 0.1733
Epoch 7, Average Loss: 0.1640
Epoch 8, Average Loss: 0.1730
Epoch 9, Average Loss: 0.1736
Epoch 10, Average Loss: 0.1742
Merged model device: cuda:0
Accuracy: 59.7614
Accuracy of sketch model on test domain: 59.7614

Training coefficients...
Training coefficients for weight averaging
Device: cuda
Coefficients device: cuda:0
Initial coefficients (after normalization):
  cartoon: 0.3333
  photo: 0.3333
  sketch: 0.3333
Expert model cartoon device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Domain cartoon - Input device: cuda:0, Model device: cuda:0
Domain photo - Input device: cuda:0, Model device: cuda:0
Domain sketch - Input device: cuda:0, Model device: cuda:0
Coefficient Epoch 1, Average Loss: 1.1032
Coefficient Epoch 2, Average Loss: 0.8130
Coefficient Epoch 3, Average Loss: 0.7285
Coefficient Epoch 4, Average Loss: 0.7266
Coefficient Epoch 5, Average Loss: 0.8082
Coefficient Epoch 6, Average Loss: 0.7483
Coefficient Epoch 7, Average Loss: 0.7543
Coefficient Epoch 8, Average Loss: 0.7398
Coefficient Epoch 9, Average Loss: 0.7411
Coefficient Epoch 10, Average Loss: 0.8038
Final device check:
Expert model cartoon device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Coefficient training complete.
Learned coefficients: [0.33513399958610535, 0.3104903995990753, 0.3543756306171417]

Creating weight-averaged model...
Creating weight-averaged model
Weight-averaged model created.

Evaluating final model...
Accuracy: 88.8829
Final model accuracy on test domain: 88.8829

Run 2/10
Preparing data...
Domains: ['art_painting', 'cartoon', 'photo', 'sketch']
Selected test domain: cartoon
Training domains: ['art_painting', 'photo', 'sketch']

Domain: cartoon
  Class person: 405 samples
  Class giraffe: 346 samples
  Class elephant: 457 samples
  Class house: 288 samples
  Class guitar: 135 samples
  Class dog: 389 samples
  Class horse: 324 samples
  Total samples: 2344

Domain: sketch
  Class person: 160 samples
  Class giraffe: 753 samples
  Class elephant: 740 samples
  Class house: 80 samples
  Class guitar: 608 samples
  Class dog: 772 samples
  Class horse: 816 samples
  Total samples: 3929

Domain: art_painting
  Class person: 449 samples
  Class giraffe: 285 samples
  Class elephant: 255 samples
  Class house: 295 samples
  Class guitar: 184 samples
  Class dog: 379 samples
  Class horse: 201 samples
  Total samples: 2048

Domain: photo
  Class person: 432 samples
  Class giraffe: 182 samples
  Class elephant: 202 samples
  Class house: 280 samples
  Class guitar: 186 samples
  Class dog: 189 samples
  Class horse: 199 samples
  Total samples: 1670
Test domain: cartoon
Performing naive fine-tuning on test domain
Epoch 1, Average Loss: 5.3093
Epoch 2, Average Loss: 3.2894
Epoch 3, Average Loss: 2.7873
Epoch 4, Average Loss: 2.2349
Epoch 5, Average Loss: 2.1408
Epoch 6, Average Loss: 2.1531
Epoch 7, Average Loss: 1.9747
Epoch 8, Average Loss: 2.3769
Epoch 9, Average Loss: 2.2531
Epoch 10, Average Loss: 2.3029
Accuracy: 16.8720
Training domains: ['art_painting', 'photo', 'sketch']

Training expert models...

Training model for domain: art_painting
Training model for domain: art_painting
Epoch 1, Average Loss: 0.4480
Epoch 2, Average Loss: 0.1172
Epoch 3, Average Loss: 0.1223
Epoch 4, Average Loss: 0.1139
Epoch 5, Average Loss: 0.1424
Epoch 6, Average Loss: 0.1232
Epoch 7, Average Loss: 0.1338
Epoch 8, Average Loss: 0.1220
Epoch 9, Average Loss: 0.1090
Epoch 10, Average Loss: 0.1001
Merged model device: cuda:0
Accuracy: 74.0284
Accuracy of art_painting model on test domain: 74.0284

Training model for domain: photo
Training model for domain: photo
Epoch 1, Average Loss: 0.1798
Epoch 2, Average Loss: 0.0433
Epoch 3, Average Loss: 0.0617
Epoch 4, Average Loss: 0.0512
Epoch 5, Average Loss: 0.0495
Epoch 6, Average Loss: 0.0615
Epoch 7, Average Loss: 0.0399
Epoch 8, Average Loss: 0.0792
Epoch 9, Average Loss: 0.0963
Epoch 10, Average Loss: 0.0541
Merged model device: cuda:0
Accuracy: 36.1137
Accuracy of photo model on test domain: 36.1137

Training model for domain: sketch
Training model for domain: sketch
Epoch 1, Average Loss: 0.5790
Epoch 2, Average Loss: 0.2294
Epoch 3, Average Loss: 0.1968
Epoch 4, Average Loss: 0.1486
Epoch 5, Average Loss: 0.1886
Epoch 6, Average Loss: 0.1609
Epoch 7, Average Loss: 0.1581
Epoch 8, Average Loss: 0.1755
Epoch 9, Average Loss: 0.1581
Epoch 10, Average Loss: 0.1699
Merged model device: cuda:0
Accuracy: 65.0711
Accuracy of sketch model on test domain: 65.0711

Training coefficients...
Training coefficients for weight averaging
Device: cuda
Coefficients device: cuda:0
Initial coefficients (after normalization):
  art_painting: 0.3333
  photo: 0.3333
  sketch: 0.3333
Expert model art_painting device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Domain art_painting - Input device: cuda:0, Model device: cuda:0
Domain photo - Input device: cuda:0, Model device: cuda:0
Domain sketch - Input device: cuda:0, Model device: cuda:0
Coefficient Epoch 1, Average Loss: 1.2967
Coefficient Epoch 2, Average Loss: 0.7234
Coefficient Epoch 3, Average Loss: 0.7067
Coefficient Epoch 4, Average Loss: 0.7595
Coefficient Epoch 5, Average Loss: 0.7216
Coefficient Epoch 6, Average Loss: 0.7372
Coefficient Epoch 7, Average Loss: 0.6330
Coefficient Epoch 8, Average Loss: 0.6961
Coefficient Epoch 9, Average Loss: 0.6737
Coefficient Epoch 10, Average Loss: 0.6442
Final device check:
Expert model art_painting device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Coefficient training complete.
Learned coefficients: [0.3975392282009125, 0.28347158432006836, 0.3189891576766968]

Creating weight-averaged model...
Creating weight-averaged model
Weight-averaged model created.

Evaluating final model...
Accuracy: 79.6209
Final model accuracy on test domain: 79.6209

Run 3/10
Preparing data...
Domains: ['art_painting', 'cartoon', 'photo', 'sketch']
Selected test domain: photo
Training domains: ['art_painting', 'cartoon', 'sketch']

Domain: cartoon
  Class person: 405 samples
  Class giraffe: 346 samples
  Class elephant: 457 samples
  Class house: 288 samples
  Class guitar: 135 samples
  Class dog: 389 samples
  Class horse: 324 samples
  Total samples: 2344

Domain: sketch
  Class person: 160 samples
  Class giraffe: 753 samples
  Class elephant: 740 samples
  Class house: 80 samples
  Class guitar: 608 samples
  Class dog: 772 samples
  Class horse: 816 samples
  Total samples: 3929

Domain: art_painting
  Class person: 449 samples
  Class giraffe: 285 samples
  Class elephant: 255 samples
  Class house: 295 samples
  Class guitar: 184 samples
  Class dog: 379 samples
  Class horse: 201 samples
  Total samples: 2048

Domain: photo
  Class person: 432 samples
  Class giraffe: 182 samples
  Class elephant: 202 samples
  Class house: 280 samples
  Class guitar: 186 samples
  Class dog: 189 samples
  Class horse: 199 samples
  Total samples: 1670
Test domain: photo
Performing naive fine-tuning on test domain
Epoch 1, Average Loss: 7.1259
Epoch 2, Average Loss: 5.2454
Epoch 3, Average Loss: 3.5301
Epoch 4, Average Loss: 2.7070
Epoch 5, Average Loss: 2.2570
Epoch 6, Average Loss: 2.2863
Epoch 7, Average Loss: 2.1534
Epoch 8, Average Loss: 2.0680
Epoch 9, Average Loss: 1.9800
Epoch 10, Average Loss: 2.2546
Accuracy: 12.1091
Training domains: ['art_painting', 'cartoon', 'sketch']

Training expert models...

Training model for domain: art_painting
Training model for domain: art_painting
Epoch 1, Average Loss: 0.4562
Epoch 2, Average Loss: 0.1497
Epoch 3, Average Loss: 0.1079
Epoch 4, Average Loss: 0.1504
Epoch 5, Average Loss: 0.1320
Epoch 6, Average Loss: 0.1704
Epoch 7, Average Loss: 0.1655
Epoch 8, Average Loss: 0.1004
Epoch 9, Average Loss: 0.1179
Epoch 10, Average Loss: 0.1044
Merged model device: cuda:0
Accuracy: 94.4112
Accuracy of art_painting model on test domain: 94.4112

Training model for domain: cartoon
Training model for domain: cartoon
Epoch 1, Average Loss: 0.4743
Epoch 2, Average Loss: 0.1764
Epoch 3, Average Loss: 0.1223
Epoch 4, Average Loss: 0.1147
Epoch 5, Average Loss: 0.1242
Epoch 6, Average Loss: 0.0886
Epoch 7, Average Loss: 0.1478
Epoch 8, Average Loss: 0.1064
Epoch 9, Average Loss: 0.1089
Epoch 10, Average Loss: 0.0902
Merged model device: cuda:0
Accuracy: 89.6873
Accuracy of cartoon model on test domain: 89.6873

Training model for domain: sketch
Training model for domain: sketch
Epoch 1, Average Loss: 0.5066
Epoch 2, Average Loss: 0.2350
Epoch 3, Average Loss: 0.1760
Epoch 4, Average Loss: 0.1721
Epoch 5, Average Loss: 0.1648
Epoch 6, Average Loss: 0.1686
Epoch 7, Average Loss: 0.2086
Epoch 8, Average Loss: 0.1855
Epoch 9, Average Loss: 0.1618
Epoch 10, Average Loss: 0.1574
Merged model device: cuda:0
Accuracy: 55.2229
Accuracy of sketch model on test domain: 55.2229

Training coefficients...
Training coefficients for weight averaging
Device: cuda
Coefficients device: cuda:0
Initial coefficients (after normalization):
  art_painting: 0.3333
  cartoon: 0.3333
  sketch: 0.3333
Expert model art_painting device: cuda:0
Expert model cartoon device: cuda:0
Expert model sketch device: cuda:0
Domain art_painting - Input device: cuda:0, Model device: cuda:0
Domain cartoon - Input device: cuda:0, Model device: cuda:0
Domain sketch - Input device: cuda:0, Model device: cuda:0
Coefficient Epoch 1, Average Loss: 0.1537
Coefficient Epoch 2, Average Loss: 0.1837
Coefficient Epoch 3, Average Loss: 0.2994
Coefficient Epoch 4, Average Loss: 0.1026
Coefficient Epoch 5, Average Loss: 0.1043
Coefficient Epoch 6, Average Loss: 0.2231
Coefficient Epoch 7, Average Loss: 0.2310
Coefficient Epoch 8, Average Loss: 0.1677
Coefficient Epoch 9, Average Loss: 0.1492
Coefficient Epoch 10, Average Loss: 0.3127
Final device check:
Expert model art_painting device: cuda:0
Expert model cartoon device: cuda:0
Expert model sketch device: cuda:0
Coefficient training complete.
Learned coefficients: [0.4065442383289337, 0.3171755075454712, 0.27628016471862793]

Creating weight-averaged model...
Creating weight-averaged model
Weight-averaged model created.

Evaluating final model...
Accuracy: 99.3347
Final model accuracy on test domain: 99.3347

Run 4/10
Preparing data...
Domains: ['art_painting', 'cartoon', 'photo', 'sketch']
Selected test domain: sketch
Training domains: ['art_painting', 'cartoon', 'photo']

Domain: cartoon
  Class person: 405 samples
  Class giraffe: 346 samples
  Class elephant: 457 samples
  Class house: 288 samples
  Class guitar: 135 samples
  Class dog: 389 samples
  Class horse: 324 samples
  Total samples: 2344

Domain: sketch
  Class person: 160 samples
  Class giraffe: 753 samples
  Class elephant: 740 samples
  Class house: 80 samples
  Class guitar: 608 samples
  Class dog: 772 samples
  Class horse: 816 samples
  Total samples: 3929

Domain: art_painting
  Class person: 449 samples
  Class giraffe: 285 samples
  Class elephant: 255 samples
  Class house: 295 samples
  Class guitar: 184 samples
  Class dog: 379 samples
  Class horse: 201 samples
  Total samples: 2048

Domain: photo
  Class person: 432 samples
  Class giraffe: 182 samples
  Class elephant: 202 samples
  Class house: 280 samples
  Class guitar: 186 samples
  Class dog: 189 samples
  Class horse: 199 samples
  Total samples: 1670
Test domain: sketch
Performing naive fine-tuning on test domain
Epoch 1, Average Loss: 4.7356
Epoch 2, Average Loss: 2.1587
Epoch 3, Average Loss: 2.2259
Epoch 4, Average Loss: 2.0782
Epoch 5, Average Loss: 1.9197
Epoch 6, Average Loss: 1.9096
Epoch 7, Average Loss: 1.9025
Epoch 8, Average Loss: 1.8737
Epoch 9, Average Loss: 1.9637
Epoch 10, Average Loss: 1.9670
Accuracy: 19.2819
Training domains: ['art_painting', 'cartoon', 'photo']

Training expert models...

Training model for domain: art_painting
Training model for domain: art_painting
Epoch 1, Average Loss: 0.4591
Epoch 2, Average Loss: 0.1370
Epoch 3, Average Loss: 0.1125
Epoch 4, Average Loss: 0.1211
Epoch 5, Average Loss: 0.1503
Epoch 6, Average Loss: 0.1252
Epoch 7, Average Loss: 0.0979
Epoch 8, Average Loss: 0.1156
Epoch 9, Average Loss: 0.1089
Epoch 10, Average Loss: 0.0876
Merged model device: cuda:0
Accuracy: 59.7399
Accuracy of art_painting model on test domain: 59.7399

Training model for domain: cartoon
Training model for domain: cartoon
Epoch 1, Average Loss: 0.5847
Epoch 2, Average Loss: 0.2057
Epoch 3, Average Loss: 0.1292
Epoch 4, Average Loss: 0.1018
Epoch 5, Average Loss: 0.0895
Epoch 6, Average Loss: 0.0980
Epoch 7, Average Loss: 0.0847
Epoch 8, Average Loss: 0.1382
Epoch 9, Average Loss: 0.1330
Epoch 10, Average Loss: 0.1181
Merged model device: cuda:0
Accuracy: 58.1566
Accuracy of cartoon model on test domain: 58.1566

Training model for domain: photo
Training model for domain: photo
Epoch 1, Average Loss: 0.2117
Epoch 2, Average Loss: 0.0545
Epoch 3, Average Loss: 0.0426
Epoch 4, Average Loss: 0.0711
Epoch 5, Average Loss: 0.0586
Epoch 6, Average Loss: 0.0452
Epoch 7, Average Loss: 0.0691
Epoch 8, Average Loss: 0.1897
Epoch 9, Average Loss: 0.1048
Epoch 10, Average Loss: 0.0387
Merged model device: cuda:0
Accuracy: 22.8725
Accuracy of photo model on test domain: 22.8725

Training coefficients...
Training coefficients for weight averaging
Device: cuda
Coefficients device: cuda:0
Initial coefficients (after normalization):
  art_painting: 0.3333
  cartoon: 0.3333
  photo: 0.3333
Expert model art_painting device: cuda:0
Expert model cartoon device: cuda:0
Expert model photo device: cuda:0
Domain art_painting - Input device: cuda:0, Model device: cuda:0
Domain cartoon - Input device: cuda:0, Model device: cuda:0
Domain photo - Input device: cuda:0, Model device: cuda:0
Coefficient Epoch 1, Average Loss: 0.9761
Coefficient Epoch 2, Average Loss: 0.7763
Coefficient Epoch 3, Average Loss: 0.7351
Coefficient Epoch 4, Average Loss: 0.7534
Coefficient Epoch 5, Average Loss: 0.7285
Coefficient Epoch 6, Average Loss: 0.8116
Coefficient Epoch 7, Average Loss: 0.7369
Coefficient Epoch 8, Average Loss: 0.7533
Coefficient Epoch 9, Average Loss: 0.7308
Coefficient Epoch 10, Average Loss: 0.7574
Final device check:
Expert model art_painting device: cuda:0
Expert model cartoon device: cuda:0
Expert model photo device: cuda:0
Coefficient training complete.
Learned coefficients: [0.37860721349716187, 0.39889463782310486, 0.22249819338321686]

Creating weight-averaged model...
Creating weight-averaged model
Weight-averaged model created.

Evaluating final model...
Accuracy: 80.8878
Final model accuracy on test domain: 80.8878

Run 5/10
Preparing data...
Domains: ['art_painting', 'cartoon', 'photo', 'sketch']
Selected test domain: art_painting
Training domains: ['cartoon', 'photo', 'sketch']

Domain: cartoon
  Class person: 405 samples
  Class giraffe: 346 samples
  Class elephant: 457 samples
  Class house: 288 samples
  Class guitar: 135 samples
  Class dog: 389 samples
  Class horse: 324 samples
  Total samples: 2344

Domain: sketch
  Class person: 160 samples
  Class giraffe: 753 samples
  Class elephant: 740 samples
  Class house: 80 samples
  Class guitar: 608 samples
  Class dog: 772 samples
  Class horse: 816 samples
  Total samples: 3929

Domain: art_painting
  Class person: 449 samples
  Class giraffe: 285 samples
  Class elephant: 255 samples
  Class house: 295 samples
  Class guitar: 184 samples
  Class dog: 379 samples
  Class horse: 201 samples
  Total samples: 2048

Domain: photo
  Class person: 432 samples
  Class giraffe: 182 samples
  Class elephant: 202 samples
  Class house: 280 samples
  Class guitar: 186 samples
  Class dog: 189 samples
  Class horse: 199 samples
  Total samples: 1670
Test domain: art_painting
Performing naive fine-tuning on test domain
Epoch 1, Average Loss: 5.4630
Epoch 2, Average Loss: 2.2575
Epoch 3, Average Loss: 2.1384
Epoch 4, Average Loss: 2.0892
Epoch 5, Average Loss: 1.9714
Epoch 6, Average Loss: 1.9433
Epoch 7, Average Loss: 1.9647
Epoch 8, Average Loss: 2.0791
Epoch 9, Average Loss: 1.9342
Epoch 10, Average Loss: 2.0855
Accuracy: 23.8069
Training domains: ['cartoon', 'photo', 'sketch']

Training expert models...

Training model for domain: cartoon
Training model for domain: cartoon
Epoch 1, Average Loss: 0.5032
Epoch 2, Average Loss: 0.1548
Epoch 3, Average Loss: 0.1568
Epoch 4, Average Loss: 0.1249
Epoch 5, Average Loss: 0.1301
Epoch 6, Average Loss: 0.1140
Epoch 7, Average Loss: 0.1237
Epoch 8, Average Loss: 0.1006
Epoch 9, Average Loss: 0.0813
Epoch 10, Average Loss: 0.0695
Merged model device: cuda:0
Accuracy: 71.0954
Accuracy of cartoon model on test domain: 71.0954

Training model for domain: photo
Training model for domain: photo
Epoch 1, Average Loss: 0.1704
Epoch 2, Average Loss: 0.0541
Epoch 3, Average Loss: 0.0454
Epoch 4, Average Loss: 0.0369
Epoch 5, Average Loss: 0.0464
Epoch 6, Average Loss: 0.1265
Epoch 7, Average Loss: 0.0898
Epoch 8, Average Loss: 0.0450
Epoch 9, Average Loss: 0.0310
Epoch 10, Average Loss: 0.0214
Merged model device: cuda:0
Accuracy: 64.3167
Accuracy of photo model on test domain: 64.3167

Training model for domain: sketch
Training model for domain: sketch
Epoch 1, Average Loss: 0.5916
Epoch 2, Average Loss: 0.2449
Epoch 3, Average Loss: 0.1673
Epoch 4, Average Loss: 0.1807
Epoch 5, Average Loss: 0.1580
Epoch 6, Average Loss: 0.1755
Epoch 7, Average Loss: 0.1615
Epoch 8, Average Loss: 0.1763
Epoch 9, Average Loss: 0.1874
Epoch 10, Average Loss: 0.1712
Merged model device: cuda:0
Accuracy: 55.2061
Accuracy of sketch model on test domain: 55.2061

Training coefficients...
Training coefficients for weight averaging
Device: cuda
Coefficients device: cuda:0
Initial coefficients (after normalization):
  cartoon: 0.3333
  photo: 0.3333
  sketch: 0.3333
Expert model cartoon device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Domain cartoon - Input device: cuda:0, Model device: cuda:0
Domain photo - Input device: cuda:0, Model device: cuda:0
Domain sketch - Input device: cuda:0, Model device: cuda:0
Coefficient Epoch 1, Average Loss: 0.7598
Coefficient Epoch 2, Average Loss: 0.6211
Coefficient Epoch 3, Average Loss: 0.5653
Coefficient Epoch 4, Average Loss: 0.5710
Coefficient Epoch 5, Average Loss: 0.5389
Coefficient Epoch 6, Average Loss: 0.6218
Coefficient Epoch 7, Average Loss: 0.5423
Coefficient Epoch 8, Average Loss: 0.5548
Coefficient Epoch 9, Average Loss: 0.5128
Coefficient Epoch 10, Average Loss: 0.5128
Final device check:
Expert model cartoon device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Coefficient training complete.
Learned coefficients: [0.347360223531723, 0.3184225261211395, 0.33421725034713745]

Creating weight-averaged model...
Creating weight-averaged model
Weight-averaged model created.

Evaluating final model...
Accuracy: 89.4252
Final model accuracy on test domain: 89.4252

Run 6/10
Preparing data...
Domains: ['art_painting', 'cartoon', 'photo', 'sketch']
Selected test domain: cartoon
Training domains: ['art_painting', 'photo', 'sketch']

Domain: cartoon
  Class person: 405 samples
  Class giraffe: 346 samples
  Class elephant: 457 samples
  Class house: 288 samples
  Class guitar: 135 samples
  Class dog: 389 samples
  Class horse: 324 samples
  Total samples: 2344

Domain: sketch
  Class person: 160 samples
  Class giraffe: 753 samples
  Class elephant: 740 samples
  Class house: 80 samples
  Class guitar: 608 samples
  Class dog: 772 samples
  Class horse: 816 samples
  Total samples: 3929

Domain: art_painting
  Class person: 449 samples
  Class giraffe: 285 samples
  Class elephant: 255 samples
  Class house: 295 samples
  Class guitar: 184 samples
  Class dog: 379 samples
  Class horse: 201 samples
  Total samples: 2048

Domain: photo
  Class person: 432 samples
  Class giraffe: 182 samples
  Class elephant: 202 samples
  Class house: 280 samples
  Class guitar: 186 samples
  Class dog: 189 samples
  Class horse: 199 samples
  Total samples: 1670
Test domain: cartoon
Performing naive fine-tuning on test domain
Epoch 1, Average Loss: 3.6672
Epoch 2, Average Loss: 2.3474
Epoch 3, Average Loss: 2.0171
Epoch 4, Average Loss: 1.9861
Epoch 5, Average Loss: 2.0395
Epoch 6, Average Loss: 2.0594
Epoch 7, Average Loss: 2.0586
Epoch 8, Average Loss: 2.0283
Epoch 9, Average Loss: 2.0461
Epoch 10, Average Loss: 1.9975
Accuracy: 19.1469
Training domains: ['art_painting', 'photo', 'sketch']

Training expert models...

Training model for domain: art_painting
Training model for domain: art_painting
Epoch 1, Average Loss: 0.5121
Epoch 2, Average Loss: 0.1473
Epoch 3, Average Loss: 0.1181
Epoch 4, Average Loss: 0.1459
Epoch 5, Average Loss: 0.1047
Epoch 6, Average Loss: 0.1528
Epoch 7, Average Loss: 0.1366
Epoch 8, Average Loss: 0.1567
Epoch 9, Average Loss: 0.1125
Epoch 10, Average Loss: 0.1131
Merged model device: cuda:0
Accuracy: 67.6777
Accuracy of art_painting model on test domain: 67.6777

Training model for domain: photo
Training model for domain: photo
Epoch 1, Average Loss: 0.2087
Epoch 2, Average Loss: 0.0289
Epoch 3, Average Loss: 0.0359
Epoch 4, Average Loss: 0.0565
Epoch 5, Average Loss: 0.0229
Epoch 6, Average Loss: 0.0430
Epoch 7, Average Loss: 0.1177
Epoch 8, Average Loss: 0.0387
Epoch 9, Average Loss: 0.0472
Epoch 10, Average Loss: 0.0335
Merged model device: cuda:0
Accuracy: 40.1896
Accuracy of photo model on test domain: 40.1896

Training model for domain: sketch
Training model for domain: sketch
Epoch 1, Average Loss: 0.5328
Epoch 2, Average Loss: 0.2027
Epoch 3, Average Loss: 0.1657
Epoch 4, Average Loss: 0.1644
Epoch 5, Average Loss: 0.1737
Epoch 6, Average Loss: 0.1614
Epoch 7, Average Loss: 0.1775
Epoch 8, Average Loss: 0.1663
Epoch 9, Average Loss: 0.1562
Epoch 10, Average Loss: 0.1510
Merged model device: cuda:0
Accuracy: 62.8910
Accuracy of sketch model on test domain: 62.8910

Training coefficients...
Training coefficients for weight averaging
Device: cuda
Coefficients device: cuda:0
Initial coefficients (after normalization):
  art_painting: 0.3333
  photo: 0.3333
  sketch: 0.3333
Expert model art_painting device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Domain art_painting - Input device: cuda:0, Model device: cuda:0
Domain photo - Input device: cuda:0, Model device: cuda:0
Domain sketch - Input device: cuda:0, Model device: cuda:0
Coefficient Epoch 1, Average Loss: 1.4024
Coefficient Epoch 2, Average Loss: 0.8214
Coefficient Epoch 3, Average Loss: 0.8227
Coefficient Epoch 4, Average Loss: 0.8182
Coefficient Epoch 5, Average Loss: 0.7695
Coefficient Epoch 6, Average Loss: 0.7845
Coefficient Epoch 7, Average Loss: 0.7780
Coefficient Epoch 8, Average Loss: 0.7467
Coefficient Epoch 9, Average Loss: 0.7581
Coefficient Epoch 10, Average Loss: 0.7774
Final device check:
Expert model art_painting device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Coefficient training complete.
Learned coefficients: [0.3806496560573578, 0.26761355996131897, 0.35173678398132324]

Creating weight-averaged model...
Creating weight-averaged model
Weight-averaged model created.

Evaluating final model...
Accuracy: 75.7346
Final model accuracy on test domain: 75.7346

Run 7/10
Preparing data...
Domains: ['art_painting', 'cartoon', 'photo', 'sketch']
Selected test domain: photo
Training domains: ['art_painting', 'cartoon', 'sketch']

Domain: cartoon
  Class person: 405 samples
  Class giraffe: 346 samples
  Class elephant: 457 samples
  Class house: 288 samples
  Class guitar: 135 samples
  Class dog: 389 samples
  Class horse: 324 samples
  Total samples: 2344

Domain: sketch
  Class person: 160 samples
  Class giraffe: 753 samples
  Class elephant: 740 samples
  Class house: 80 samples
  Class guitar: 608 samples
  Class dog: 772 samples
  Class horse: 816 samples
  Total samples: 3929

Domain: art_painting
  Class person: 449 samples
  Class giraffe: 285 samples
  Class elephant: 255 samples
  Class house: 295 samples
  Class guitar: 184 samples
  Class dog: 379 samples
  Class horse: 201 samples
  Total samples: 2048

Domain: photo
  Class person: 432 samples
  Class giraffe: 182 samples
  Class elephant: 202 samples
  Class house: 280 samples
  Class guitar: 186 samples
  Class dog: 189 samples
  Class horse: 199 samples
  Total samples: 1670
Test domain: photo
Performing naive fine-tuning on test domain
Epoch 1, Average Loss: 5.2917
Epoch 2, Average Loss: 3.1621
Epoch 3, Average Loss: 2.2973
Epoch 4, Average Loss: 2.2002
Epoch 5, Average Loss: 2.0526
Epoch 6, Average Loss: 1.9994
Epoch 7, Average Loss: 1.9520
Epoch 8, Average Loss: 2.0145
Epoch 9, Average Loss: 1.9774
Epoch 10, Average Loss: 1.9758
Accuracy: 29.2748
Training domains: ['art_painting', 'cartoon', 'sketch']

Training expert models...

Training model for domain: art_painting
Training model for domain: art_painting
Epoch 1, Average Loss: 0.4485
Epoch 2, Average Loss: 0.1597
Epoch 3, Average Loss: 0.1066
Epoch 4, Average Loss: 0.1422
Epoch 5, Average Loss: 0.1052
Epoch 6, Average Loss: 0.1052
Epoch 7, Average Loss: 0.1151
Epoch 8, Average Loss: 0.1494
Epoch 9, Average Loss: 0.1201
Epoch 10, Average Loss: 0.1585
Merged model device: cuda:0
Accuracy: 95.9415
Accuracy of art_painting model on test domain: 95.9415

Training model for domain: cartoon
Training model for domain: cartoon
Epoch 1, Average Loss: 0.4744
Epoch 2, Average Loss: 0.1441
Epoch 3, Average Loss: 0.1220
Epoch 4, Average Loss: 0.1121
Epoch 5, Average Loss: 0.1540
Epoch 6, Average Loss: 0.1155
Epoch 7, Average Loss: 0.1255
Epoch 8, Average Loss: 0.1050
Epoch 9, Average Loss: 0.1139
Epoch 10, Average Loss: 0.1405
Merged model device: cuda:0
Accuracy: 83.1670
Accuracy of cartoon model on test domain: 83.1670

Training model for domain: sketch
Training model for domain: sketch
Epoch 1, Average Loss: 0.5122
Epoch 2, Average Loss: 0.2242
Epoch 3, Average Loss: 0.1805
Epoch 4, Average Loss: 0.1798
Epoch 5, Average Loss: 0.1549
Epoch 6, Average Loss: 0.1885
Epoch 7, Average Loss: 0.1737
Epoch 8, Average Loss: 0.1617
Epoch 9, Average Loss: 0.2105
Epoch 10, Average Loss: 0.1744
Merged model device: cuda:0
Accuracy: 60.4790
Accuracy of sketch model on test domain: 60.4790

Training coefficients...
Training coefficients for weight averaging
Device: cuda
Coefficients device: cuda:0
Initial coefficients (after normalization):
  art_painting: 0.3333
  cartoon: 0.3333
  sketch: 0.3333
Expert model art_painting device: cuda:0
Expert model cartoon device: cuda:0
Expert model sketch device: cuda:0
Domain art_painting - Input device: cuda:0, Model device: cuda:0
Domain cartoon - Input device: cuda:0, Model device: cuda:0
Domain sketch - Input device: cuda:0, Model device: cuda:0
Coefficient Epoch 1, Average Loss: 0.0988
Coefficient Epoch 2, Average Loss: 0.1384
Coefficient Epoch 3, Average Loss: 0.0639
Coefficient Epoch 4, Average Loss: 0.0668
Coefficient Epoch 5, Average Loss: 0.0693
Coefficient Epoch 6, Average Loss: 0.1632
Coefficient Epoch 7, Average Loss: 0.0569
Coefficient Epoch 8, Average Loss: 0.1927
Coefficient Epoch 9, Average Loss: 0.0925
Coefficient Epoch 10, Average Loss: 0.1220
Final device check:
Expert model art_painting device: cuda:0
Expert model cartoon device: cuda:0
Expert model sketch device: cuda:0
Coefficient training complete.
Learned coefficients: [0.4390285611152649, 0.21446000039577484, 0.3465114235877991]

Creating weight-averaged model...
Creating weight-averaged model
Weight-averaged model created.

Evaluating final model...
Accuracy: 98.9355
Final model accuracy on test domain: 98.9355

Run 8/10
Preparing data...
Domains: ['art_painting', 'cartoon', 'photo', 'sketch']
Selected test domain: sketch
Training domains: ['art_painting', 'cartoon', 'photo']

Domain: cartoon
  Class person: 405 samples
  Class giraffe: 346 samples
  Class elephant: 457 samples
  Class house: 288 samples
  Class guitar: 135 samples
  Class dog: 389 samples
  Class horse: 324 samples
  Total samples: 2344

Domain: sketch
  Class person: 160 samples
  Class giraffe: 753 samples
  Class elephant: 740 samples
  Class house: 80 samples
  Class guitar: 608 samples
  Class dog: 772 samples
  Class horse: 816 samples
  Total samples: 3929

Domain: art_painting
  Class person: 449 samples
  Class giraffe: 285 samples
  Class elephant: 255 samples
  Class house: 295 samples
  Class guitar: 184 samples
  Class dog: 379 samples
  Class horse: 201 samples
  Total samples: 2048

Domain: photo
  Class person: 432 samples
  Class giraffe: 182 samples
  Class elephant: 202 samples
  Class house: 280 samples
  Class guitar: 186 samples
  Class dog: 189 samples
  Class horse: 199 samples
  Total samples: 1670
Test domain: sketch
Performing naive fine-tuning on test domain
Epoch 1, Average Loss: 5.3196
Epoch 2, Average Loss: 2.9646
Epoch 3, Average Loss: 2.0952
Epoch 4, Average Loss: 1.9877
Epoch 5, Average Loss: 1.8839
Epoch 6, Average Loss: 1.8794
Epoch 7, Average Loss: 1.9326
Epoch 8, Average Loss: 1.9361
Epoch 9, Average Loss: 2.0819
Epoch 10, Average Loss: 1.9194
Accuracy: 20.7803
Training domains: ['art_painting', 'cartoon', 'photo']

Training expert models...

Training model for domain: art_painting
Training model for domain: art_painting
Epoch 1, Average Loss: 0.4783
Epoch 2, Average Loss: 0.1533
Epoch 3, Average Loss: 0.1191
Epoch 4, Average Loss: 0.1062
Epoch 5, Average Loss: 0.1387
Epoch 6, Average Loss: 0.1459
Epoch 7, Average Loss: 0.1136
Epoch 8, Average Loss: 0.1701
Epoch 9, Average Loss: 0.1529
Epoch 10, Average Loss: 0.1367
Merged model device: cuda:0
Accuracy: 67.5714
Accuracy of art_painting model on test domain: 67.5714

Training model for domain: cartoon
Training model for domain: cartoon
Epoch 1, Average Loss: 0.5093
Epoch 2, Average Loss: 0.1688
Epoch 3, Average Loss: 0.1469
Epoch 4, Average Loss: 0.1283
Epoch 5, Average Loss: 0.1115
Epoch 6, Average Loss: 0.1487
Epoch 7, Average Loss: 0.1262
Epoch 8, Average Loss: 0.1075
Epoch 9, Average Loss: 0.0925
Epoch 10, Average Loss: 0.0731
Merged model device: cuda:0
Accuracy: 56.8278
Accuracy of cartoon model on test domain: 56.8278

Training model for domain: photo
Training model for domain: photo
Epoch 1, Average Loss: 0.1929
Epoch 2, Average Loss: 0.0447
Epoch 3, Average Loss: 0.0604
Epoch 4, Average Loss: 0.0638
Epoch 5, Average Loss: 0.0714
Epoch 6, Average Loss: 0.0740
Epoch 7, Average Loss: 0.0454
Epoch 8, Average Loss: 0.1340
Epoch 9, Average Loss: 0.0564
Epoch 10, Average Loss: 0.0749
Merged model device: cuda:0
Accuracy: 29.8275
Accuracy of photo model on test domain: 29.8275

Training coefficients...
Training coefficients for weight averaging
Device: cuda
Coefficients device: cuda:0
Initial coefficients (after normalization):
  art_painting: 0.3333
  cartoon: 0.3333
  photo: 0.3333
Expert model art_painting device: cuda:0
Expert model cartoon device: cuda:0
Expert model photo device: cuda:0
Domain art_painting - Input device: cuda:0, Model device: cuda:0
Domain cartoon - Input device: cuda:0, Model device: cuda:0
Domain photo - Input device: cuda:0, Model device: cuda:0
Coefficient Epoch 1, Average Loss: 1.4366
Coefficient Epoch 2, Average Loss: 0.9022
Coefficient Epoch 3, Average Loss: 0.8335
Coefficient Epoch 4, Average Loss: 0.8067
Coefficient Epoch 5, Average Loss: 0.7846
Coefficient Epoch 6, Average Loss: 0.8581
Coefficient Epoch 7, Average Loss: 0.8157
Coefficient Epoch 8, Average Loss: 0.7829
Coefficient Epoch 9, Average Loss: 0.8183
Coefficient Epoch 10, Average Loss: 0.8253
Final device check:
Expert model art_painting device: cuda:0
Expert model cartoon device: cuda:0
Expert model photo device: cuda:0
Coefficient training complete.
Learned coefficients: [0.45210006833076477, 0.3195856213569641, 0.2283143848180771]

Creating weight-averaged model...
Creating weight-averaged model
Weight-averaged model created.

Evaluating final model...
Accuracy: 81.5663
Final model accuracy on test domain: 81.5663

Run 9/10
Preparing data...
Domains: ['art_painting', 'cartoon', 'photo', 'sketch']
Selected test domain: art_painting
Training domains: ['cartoon', 'photo', 'sketch']

Domain: cartoon
  Class person: 405 samples
  Class giraffe: 346 samples
  Class elephant: 457 samples
  Class house: 288 samples
  Class guitar: 135 samples
  Class dog: 389 samples
  Class horse: 324 samples
  Total samples: 2344

Domain: sketch
  Class person: 160 samples
  Class giraffe: 753 samples
  Class elephant: 740 samples
  Class house: 80 samples
  Class guitar: 608 samples
  Class dog: 772 samples
  Class horse: 816 samples
  Total samples: 3929

Domain: art_painting
  Class person: 449 samples
  Class giraffe: 285 samples
  Class elephant: 255 samples
  Class house: 295 samples
  Class guitar: 184 samples
  Class dog: 379 samples
  Class horse: 201 samples
  Total samples: 2048

Domain: photo
  Class person: 432 samples
  Class giraffe: 182 samples
  Class elephant: 202 samples
  Class house: 280 samples
  Class guitar: 186 samples
  Class dog: 189 samples
  Class horse: 199 samples
  Total samples: 1670
Test domain: art_painting
Performing naive fine-tuning on test domain
Epoch 1, Average Loss: 5.9565
Epoch 2, Average Loss: 2.9092
Epoch 3, Average Loss: 2.1792
Epoch 4, Average Loss: 2.0572
Epoch 5, Average Loss: 2.0131
Epoch 6, Average Loss: 2.0930
Epoch 7, Average Loss: 2.0488
Epoch 8, Average Loss: 2.0753
Epoch 9, Average Loss: 1.9871
Epoch 10, Average Loss: 2.0448
Accuracy: 21.5293
Training domains: ['cartoon', 'photo', 'sketch']

Training expert models...

Training model for domain: cartoon
Training model for domain: cartoon
Epoch 1, Average Loss: 0.4917
Epoch 2, Average Loss: 0.1918
Epoch 3, Average Loss: 0.1185
Epoch 4, Average Loss: 0.1315
Epoch 5, Average Loss: 0.1097
Epoch 6, Average Loss: 0.1087
Epoch 7, Average Loss: 0.1035
Epoch 8, Average Loss: 0.0990
Epoch 9, Average Loss: 0.0975
Epoch 10, Average Loss: 0.0868
Merged model device: cuda:0
Accuracy: 62.7983
Accuracy of cartoon model on test domain: 62.7983

Training model for domain: photo
Training model for domain: photo
Epoch 1, Average Loss: 0.1852
Epoch 2, Average Loss: 0.0448
Epoch 3, Average Loss: 0.0549
Epoch 4, Average Loss: 0.0343
Epoch 5, Average Loss: 0.0273
Epoch 6, Average Loss: 0.0554
Epoch 7, Average Loss: 0.0321
Epoch 8, Average Loss: 0.0382
Epoch 9, Average Loss: 0.0414
Epoch 10, Average Loss: 0.1227
Merged model device: cuda:0
Accuracy: 46.6920
Accuracy of photo model on test domain: 46.6920

Training model for domain: sketch
Training model for domain: sketch
Epoch 1, Average Loss: 0.5280
Epoch 2, Average Loss: 0.2368
Epoch 3, Average Loss: 0.1582
Epoch 4, Average Loss: 0.1780
Epoch 5, Average Loss: 0.1746
Epoch 6, Average Loss: 0.1965
Epoch 7, Average Loss: 0.1638
Epoch 8, Average Loss: 0.1488
Epoch 9, Average Loss: 0.1628
Epoch 10, Average Loss: 0.1531
Merged model device: cuda:0
Accuracy: 44.9566
Accuracy of sketch model on test domain: 44.9566

Training coefficients...
Training coefficients for weight averaging
Device: cuda
Coefficients device: cuda:0
Initial coefficients (after normalization):
  cartoon: 0.3333
  photo: 0.3333
  sketch: 0.3333
Expert model cartoon device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Domain cartoon - Input device: cuda:0, Model device: cuda:0
Domain photo - Input device: cuda:0, Model device: cuda:0
Domain sketch - Input device: cuda:0, Model device: cuda:0
Coefficient Epoch 1, Average Loss: 1.8707
Coefficient Epoch 2, Average Loss: 1.1460
Coefficient Epoch 3, Average Loss: 1.1246
Coefficient Epoch 4, Average Loss: 1.0411
Coefficient Epoch 5, Average Loss: 0.9364
Coefficient Epoch 6, Average Loss: 1.0724
Coefficient Epoch 7, Average Loss: 1.0266
Coefficient Epoch 8, Average Loss: 0.9821
Coefficient Epoch 9, Average Loss: 0.9826
Coefficient Epoch 10, Average Loss: 0.9393
Final device check:
Expert model cartoon device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Coefficient training complete.
Learned coefficients: [0.38202035427093506, 0.32393917441368103, 0.2940405011177063]

Creating weight-averaged model...
Creating weight-averaged model
Weight-averaged model created.

Evaluating final model...
Accuracy: 85.9002
Final model accuracy on test domain: 85.9002

Run 10/10
Preparing data...
Domains: ['art_painting', 'cartoon', 'photo', 'sketch']
Selected test domain: cartoon
Training domains: ['art_painting', 'photo', 'sketch']

Domain: cartoon
  Class person: 405 samples
  Class giraffe: 346 samples
  Class elephant: 457 samples
  Class house: 288 samples
  Class guitar: 135 samples
  Class dog: 389 samples
  Class horse: 324 samples
  Total samples: 2344

Domain: sketch
  Class person: 160 samples
  Class giraffe: 753 samples
  Class elephant: 740 samples
  Class house: 80 samples
  Class guitar: 608 samples
  Class dog: 772 samples
  Class horse: 816 samples
  Total samples: 3929

Domain: art_painting
  Class person: 449 samples
  Class giraffe: 285 samples
  Class elephant: 255 samples
  Class house: 295 samples
  Class guitar: 184 samples
  Class dog: 379 samples
  Class horse: 201 samples
  Total samples: 2048

Domain: photo
  Class person: 432 samples
  Class giraffe: 182 samples
  Class elephant: 202 samples
  Class house: 280 samples
  Class guitar: 186 samples
  Class dog: 189 samples
  Class horse: 199 samples
  Total samples: 1670
Test domain: cartoon
Performing naive fine-tuning on test domain
Epoch 1, Average Loss: 3.7713
Epoch 2, Average Loss: 2.3313
Epoch 3, Average Loss: 2.0481
Epoch 4, Average Loss: 2.1543
Epoch 5, Average Loss: 1.9351
Epoch 6, Average Loss: 1.9673
Epoch 7, Average Loss: 1.9089
Epoch 8, Average Loss: 1.8987
Epoch 9, Average Loss: 1.8844
Epoch 10, Average Loss: 1.8971
Accuracy: 23.4123
Training domains: ['art_painting', 'photo', 'sketch']

Training expert models...

Training model for domain: art_painting
Training model for domain: art_painting
Epoch 1, Average Loss: 0.4683
Epoch 2, Average Loss: 0.1538
Epoch 3, Average Loss: 0.1421
Epoch 4, Average Loss: 0.1385
Epoch 5, Average Loss: 0.1126
Epoch 6, Average Loss: 0.0983
Epoch 7, Average Loss: 0.1181
Epoch 8, Average Loss: 0.1612
Epoch 9, Average Loss: 0.1112
Epoch 10, Average Loss: 0.1073
Merged model device: cuda:0
Accuracy: 64.6919
Accuracy of art_painting model on test domain: 64.6919

Training model for domain: photo
Training model for domain: photo
Epoch 1, Average Loss: 0.2063
Epoch 2, Average Loss: 0.0538
Epoch 3, Average Loss: 0.0307
Epoch 4, Average Loss: 0.0664
Epoch 5, Average Loss: 0.1020
Epoch 6, Average Loss: 0.0652
Epoch 7, Average Loss: 0.0506
Epoch 8, Average Loss: 0.0556
Epoch 9, Average Loss: 0.0162
Epoch 10, Average Loss: 0.0325
Merged model device: cuda:0
Accuracy: 32.9384
Accuracy of photo model on test domain: 32.9384

Training model for domain: sketch
Training model for domain: sketch
Epoch 1, Average Loss: 0.5003
Epoch 2, Average Loss: 0.1993
Epoch 3, Average Loss: 0.1825
Epoch 4, Average Loss: 0.1660
Epoch 5, Average Loss: 0.1732
Epoch 6, Average Loss: 0.1733
Epoch 7, Average Loss: 0.1940
Epoch 8, Average Loss: 0.1833
Epoch 9, Average Loss: 0.1556
Epoch 10, Average Loss: 0.1550
Merged model device: cuda:0
Accuracy: 65.4028
Accuracy of sketch model on test domain: 65.4028

Training coefficients...
Training coefficients for weight averaging
Device: cuda
Coefficients device: cuda:0
Initial coefficients (after normalization):
  art_painting: 0.3333
  photo: 0.3333
  sketch: 0.3333
Expert model art_painting device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Domain art_painting - Input device: cuda:0, Model device: cuda:0
Domain photo - Input device: cuda:0, Model device: cuda:0
Domain sketch - Input device: cuda:0, Model device: cuda:0
Coefficient Epoch 1, Average Loss: 1.6808
Coefficient Epoch 2, Average Loss: 0.8801
Coefficient Epoch 3, Average Loss: 0.7957
Coefficient Epoch 4, Average Loss: 0.8057
Coefficient Epoch 5, Average Loss: 0.7921
Coefficient Epoch 6, Average Loss: 0.7685
Coefficient Epoch 7, Average Loss: 0.7437
Coefficient Epoch 8, Average Loss: 0.8014
Coefficient Epoch 9, Average Loss: 0.8511
Coefficient Epoch 10, Average Loss: 0.8370
Final device check:
Expert model art_painting device: cuda:0
Expert model photo device: cuda:0
Expert model sketch device: cuda:0
Coefficient training complete.
Learned coefficients: [0.3657004237174988, 0.27208489179611206, 0.36221468448638916]

Creating weight-averaged model...
Creating weight-averaged model
Weight-averaged model created.

Evaluating final model...
Accuracy: 76.9194
Final model accuracy on test domain: 76.9194

Summary for PACS:
Debug: Type of results: <class 'list'>
Debug: Content of results: [{'test_domain': 'art_painting', 'domain_accuracies': {'cartoon': 56.07375271149675, 'photo': 63.99132321041214, 'sketch': 59.76138828633406}, 'final_accuracy': 88.88286334056399, 'coefficients': [0.33513399958610535, 0.3104903995990753, 0.3543756306171417]}, {'test_domain': 'cartoon', 'domain_accuracies': {'art_painting': 74.02843601895735, 'photo': 36.11374407582939, 'sketch': 65.07109004739337}, 'final_accuracy': 79.62085308056872, 'coefficients': [0.3975392282009125, 0.28347158432006836, 0.3189891576766968]}, {'test_domain': 'photo', 'domain_accuracies': {'art_painting': 94.41117764471058, 'cartoon': 89.68729208250167, 'sketch': 55.222887558216904}, 'final_accuracy': 99.3346640053227, 'coefficients': [0.4065442383289337, 0.3171755075454712, 0.27628016471862793]}, {'test_domain': 'sketch', 'domain_accuracies': {'art_painting': 59.739892564320044, 'cartoon': 58.15662991235511, 'photo': 22.872490811422107}, 'final_accuracy': 80.88775798699463, 'coefficients': [0.37860721349716187, 0.39889463782310486, 0.22249819338321686]}, {'test_domain': 'art_painting', 'domain_accuracies': {'cartoon': 71.09544468546638, 'photo': 64.31670281995662, 'sketch': 55.20607375271149}, 'final_accuracy': 89.42516268980476, 'coefficients': [0.347360223531723, 0.3184225261211395, 0.33421725034713745]}, {'test_domain': 'cartoon', 'domain_accuracies': {'art_painting': 67.67772511848341, 'photo': 40.18957345971564, 'sketch': 62.89099526066351}, 'final_accuracy': 75.73459715639811, 'coefficients': [0.3806496560573578, 0.26761355996131897, 0.35173678398132324]}, {'test_domain': 'photo', 'domain_accuracies': {'art_painting': 95.9414504324684, 'cartoon': 83.166999334664, 'sketch': 60.47904191616767}, 'final_accuracy': 98.9354624085163, 'coefficients': [0.4390285611152649, 0.21446000039577484, 0.3465114235877991]}, {'test_domain': 'sketch', 'domain_accuracies': {'art_painting': 67.57138818207521, 'cartoon': 56.82782018659881, 'photo': 29.827537461125246}, 'final_accuracy': 81.56629912355103, 'coefficients': [0.45210006833076477, 0.3195856213569641, 0.2283143848180771]}, {'test_domain': 'art_painting', 'domain_accuracies': {'cartoon': 62.79826464208242, 'photo': 46.691973969631235, 'sketch': 44.95661605206074}, 'final_accuracy': 85.90021691973969, 'coefficients': [0.38202035427093506, 0.32393917441368103, 0.2940405011177063]}, {'test_domain': 'cartoon', 'domain_accuracies': {'art_painting': 64.69194312796208, 'photo': 32.93838862559242, 'sketch': 65.40284360189574}, 'final_accuracy': 76.91943127962085, 'coefficients': [0.3657004237174988, 0.27208489179611206, 0.36221468448638916]}]
Final Model Accuracy: 85.7207 ± 7.9921
Domain-specific Accuracies:
  cartoon: 68.2580 ± 12.5385
  photo: 42.1177 ± 14.3075
  sketch: 58.6239 ± 6.3296
  art_painting: 74.8660 ± 13.4381
Average Coefficients:
  Coefficient 1: 0.3885 ± 0.0350
  Coefficient 2: 0.3026 ± 0.0456
  Coefficient 3: 0.3089 ± 0.0491
Debug: Type of results: <class 'dict'>
Debug: Content of results: {'PACS': [{'test_domain': 'art_painting', 'domain_accuracies': {'cartoon': 56.07375271149675, 'photo': 63.99132321041214, 'sketch': 59.76138828633406}, 'final_accuracy': 88.88286334056399, 'coefficients': [0.33513399958610535, 0.3104903995990753, 0.3543756306171417]}, {'test_domain': 'cartoon', 'domain_accuracies': {'art_painting': 74.02843601895735, 'photo': 36.11374407582939, 'sketch': 65.07109004739337}, 'final_accuracy': 79.62085308056872, 'coefficients': [0.3975392282009125, 0.28347158432006836, 0.3189891576766968]}, {'test_domain': 'photo', 'domain_accuracies': {'art_painting': 94.41117764471058, 'cartoon': 89.68729208250167, 'sketch': 55.222887558216904}, 'final_accuracy': 99.3346640053227, 'coefficients': [0.4065442383289337, 0.3171755075454712, 0.27628016471862793]}, {'test_domain': 'sketch', 'domain_accuracies': {'art_painting': 59.739892564320044, 'cartoon': 58.15662991235511, 'photo': 22.872490811422107}, 'final_accuracy': 80.88775798699463, 'coefficients': [0.37860721349716187, 0.39889463782310486, 0.22249819338321686]}, {'test_domain': 'art_painting', 'domain_accuracies': {'cartoon': 71.09544468546638, 'photo': 64.31670281995662, 'sketch': 55.20607375271149}, 'final_accuracy': 89.42516268980476, 'coefficients': [0.347360223531723, 0.3184225261211395, 0.33421725034713745]}, {'test_domain': 'cartoon', 'domain_accuracies': {'art_painting': 67.67772511848341, 'photo': 40.18957345971564, 'sketch': 62.89099526066351}, 'final_accuracy': 75.73459715639811, 'coefficients': [0.3806496560573578, 0.26761355996131897, 0.35173678398132324]}, {'test_domain': 'photo', 'domain_accuracies': {'art_painting': 95.9414504324684, 'cartoon': 83.166999334664, 'sketch': 60.47904191616767}, 'final_accuracy': 98.9354624085163, 'coefficients': [0.4390285611152649, 0.21446000039577484, 0.3465114235877991]}, {'test_domain': 'sketch', 'domain_accuracies': {'art_painting': 67.57138818207521, 'cartoon': 56.82782018659881, 'photo': 29.827537461125246}, 'final_accuracy': 81.56629912355103, 'coefficients': [0.45210006833076477, 0.3195856213569641, 0.2283143848180771]}, {'test_domain': 'art_painting', 'domain_accuracies': {'cartoon': 62.79826464208242, 'photo': 46.691973969631235, 'sketch': 44.95661605206074}, 'final_accuracy': 85.90021691973969, 'coefficients': [0.38202035427093506, 0.32393917441368103, 0.2940405011177063]}, {'test_domain': 'cartoon', 'domain_accuracies': {'art_painting': 64.69194312796208, 'photo': 32.93838862559242, 'sketch': 65.40284360189574}, 'final_accuracy': 76.91943127962085, 'coefficients': [0.3657004237174988, 0.27208489179611206, 0.36221468448638916]}]}
No valid results to summarize.
